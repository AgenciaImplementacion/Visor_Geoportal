function Services(){}function AjaxPrefilter(){}function StyleManager(){}function DialogUtils(){}function Utils(){}function CollapseExpandPanelUtils(){}function UserPermission(e){this.userPermission=e}function LayerConfigCatalog(){var e,t;this._layersConfig=[],this._referenceLayersForAlert=[];var a=0;this._createNewId=function(){var e=a;return a++,e},this.loadConfigFromJSON=function(a,i,n){e=a.tools,t=a.map;for(var r=a.layers,l=0;r.length>l;l++){var o=r[l];if(o.url){if(null==i[o.url])continue;o.capabilities=i[o.url]}o.id=this._createNewId();var s=null;if("wms_multi_layer"===o.source){if(s=new WMSMultiLayerConfig(o),o.url)for(var c=n[o.url],u=s.getAllLayerNamesAsListForWMSMulti(),d=0;u.length>d;d++){var g=u[d],p=new DescribeFeatureParser(c).getDescribeFeatureConfig(g);s.setAttributesForLayer(p,g)}}else if(s=new LayerConfig(o),o.url){var g=s.getName(),f=n[o.url];if(Utils.isNullOrUndefined(f)||!Utils.isNullOrUndefined(f.error))s.setWFSGetFeatureAvailable(!1),s.setAttributesAvailable(!1),Utils.isNullOrUndefined(f)||s.setAttributesNotAvailableCause(f.error);else{var p=new DescribeFeatureParser(f).getDescribeFeatureConfig(g);s.setWFSGetFeatureAvailable(!0),s.setAttributesAvailable(!0),s.setAttributes(p)}}s.isReferenceLayerForAlert()&&this._referenceLayersForAlert.push(s),this._layersConfig.push(s)}},this.getReferenceLayerForAlert=function(){var e=null;return this._referenceLayersForAlert.length>0&&(e=this._referenceLayersForAlert[0]),e},this.addLayerToConfig=function(e){e.layerConfig.id=this._createNewId(),this._layersConfig.push(e)},this.removeLayerFromConfig=function(e){for(var t=!1,a=0;this._layersConfig.length>a;){var i=this._layersConfig[a];if(i.getId()===e){t=!0;break}a++}return t?(this._layersConfig.splice(a,1),!0):!1},this.getLayerConfigs=function(){var e=[];return $.each(this._layersConfig,function(t,a){return a.layerConfig.publish===!1?!0:(e.push(a),void 0)}),e},this.getLayerConfigById=function(e){for(var t=0;this._layersConfig.length>t;t++){var a=this._layersConfig[t];if(a.getId()===e)return a}return null},this.getMapConfig=function(){return t},this.getToolConfig=function(){return e},this.existsLayerForGroup=function(e){for(var t=0;this._layersConfig.length>t;t++){var a=this._layersConfig[t];if(a.getGroup()===e)return!0}return!1}}function LayerConfig(e){this.layerConfig=e}function WMSMultiLayerConfig(e){this.layerConfig=e}function LayerInfoDialog(){}function LayerMenuUtils(){}function LayerMenu(){}function loadAllCapabilitiesFromConfig(e,t){var a=createCapabilitiesObj(e.layers);$.each(a,function(e){doGetCapabilities_JQ(e,function(i){a[e]=i,Utils.isInArray("todo",a)||t(a)},function(){a[e]=null,Utils.isInArray("todo",a)||t(a)})})}function createCapabilitiesObj(e){var t={};return $.each(e,function(e,a){a.url&&!t.hasOwnProperty(a.url)&&(t[a.url]="todo")}),t}function doGetCapabilities_JQ(e,t,a){var i=new OpenLayers.Format.WMSCapabilities({version:"1.3.0"});$.ajax({url:e,type:"GET",cache:!1,useProxy:!0,timeout:AJAX_TIMEOUT,dataType:"xml",data:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetCapabilities"}}).done(function(e,a,n){var r=n.responseXML;r&&r.documentElement||(r=n.responseText);var l=i.read(r);t(l)}).fail(function(){if(OpenLayers.Console.error("...error..."),Utils.isNullOrUndefined(a)){var e=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Title"),t=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Text");AlertDialog.createOkDefaultDialog(e,t)}else a()})}function doGetCapabilities(e,t,a){var i=new OpenLayers.Format.WMSCapabilities({version:"1.3.0"});OpenLayers.Request.GET({url:e,params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetCapabilities"},success:function(e){var a=e.responseXML;a&&a.documentElement||(a=e.responseText);var n=i.read(a);t(n)},failure:function(){if(OpenLayers.Console.error("...error..."),Utils.isNullOrUndefined(a)){var e=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Title"),t=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Text");AlertDialog.createOkDefaultDialog(e,t)}else a()}})}function doGetCapabilitiesTest(e){var t=new OpenLayers.Format.WMSCapabilities({version:"1.3.0"});OpenLayers.Request.GET({url:e,params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetCapabilities"},success:function(e){var a=e.responseXML;a&&a.documentElement||(a=e.responseText);for(var i=t.read(a),n=i.capability.layers,r="",l=0;n.length>l;l++)n[l].name&&""!=n[l].name&&(r=r+","+n[l].name)},failure:function(){OpenLayers.Console.error("...error...")}})}function checkIfSrsSupported(e,t,a){var i=!0;return $.each(a.capability.layers,function(a,n){n.name===t&&(e in n.srs||(i=!1))}),i}function loadAllDescribeFeatureFromConfig(e,t){var a=createDescribeServerObj(e.layers);$.each(a,function(e){doDescribeFeature_JQ(e,function(i){a[e]=i,Utils.isInArray("todo",a)||t(a)},function(){a[e]=null,Utils.isInArray("todo",a)||t(a)})})}function createDescribeServerObj(e){var t={};return $.each(e,function(e,a){a.url&&!t.hasOwnProperty(a.url)&&(t[a.url]="todo")}),t}function doDescribeFeature_JQ(e,t,a){var i=new OpenLayers.Format.WFSDescribeFeatureType;$.ajax({url:e,type:"GET",cache:!1,useProxy:!0,timeout:AJAX_TIMEOUT,dataType:"xml",data:{SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"DescribeFeatureType"}}).done(function(e,a,n){var r=n.responseXML;r&&r.documentElement||(r=n.responseText);var l=i.read(r);Utils.isNullOrUndefined(l.error)||(l.error.originalResponse=r),t(l)}).fail(function(){if(OpenLayers.Console.error("...error..."),OpenLayers.Console.error("...error..."),Utils.isNullOrUndefined(a)){var e=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Title"),t=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Text");AlertDialog.createOkDefaultDialog(e,t)}else a()})}function doDescribeFeature(e,t,a){var i=new OpenLayers.Format.WFSDescribeFeatureType;OpenLayers.Request.GET({url:e,params:{SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"DescribeFeatureType"},success:function(e){var a=e.responseXML;a&&a.documentElement||(a=e.responseText);var n=i.read(a);Utils.isNullOrUndefined(n.error)||(n.error.originalResponse=a),t(n)},failure:function(){if(OpenLayers.Console.error("...error..."),Utils.isNullOrUndefined(a)){var e=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Title"),t=LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Text");AlertDialog.createOkDefaultDialog(e,t)}else a()}})}function doGetFeaturesGET(e,t,a,i){var n=new OpenLayers.Format.GML.v2,r={SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"GetFeature",outputFormat:"GML2"};if(t.typeNames&&(r.typeNames=t.typeNames),t.typeName&&(r.typeName=t.typeName),t.outputFormat&&(r.outputFormat=t.outputFormat),t.propertyNames&&(r.propertyNames=t.propertyNames),t.filterOL){var l=new OpenLayers.Format.Filter({version:"1.1.0"}).write(t.filterOL),o=(new OpenLayers.Format.XML).write(l);r.filter=o}OpenLayers.Request.GET({url:e,params:r,success:function(e){var t=e.responseXML;t&&t.documentElement||(t=e.responseText),n.extractAttributes=!0;var i=n.read(t);a(i)},failure:function(){OpenLayers.Console.error("...error..."),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_RetrievingFeature")),Utils.isNullOrUndefined(i)||i()}})}function doGetFeaturesPOST(e,t,a,i){var n=catalog.getMapConfig().projection,r=t.typeNames,l=new OpenLayers.Format.GML.v2({featureType:r,geometryName:"geom",srsName:n}),o="text/xml; subtype=gml/2.1.2",s="WFS",c="1.1.0",u="1.1.0",d="text/xml;charset=utf-8",g=null;Utils.isNullOrUndefined(t.maxFeatures)||(g=t.maxFeatures);var p='<wfs:GetFeature\n service="'+s+'"\n'+' version="'+c+'"\n '+' outputFormat="'+o+'"\n ';g&&(p+=' maxFeatures="'+g+'"\n ');var f="results",h=!1;if("hits"===t.resultType&&(f="hits",h=!0),p+=' resultType="'+f+'"\n ',p+=' xmlns:wfs="http://www.opengis.net/wfs"\n>\n  <wfs:Query typeName="'+r+'" srsName="'+n+'">\n',t.filterOL){var y=new OpenLayers.Format.Filter({version:u}).write(t.filterOL),m=(new OpenLayers.Format.XML).write(y);p+=m}p+="    </wfs:Query>\n",p+="</wfs:GetFeature>";var v=function(e){var t=e.responseXML;if(t&&t.documentElement||(t=e.responseText),h){var i=e.responseText.match(/numberOfFeatures="([0-9]+)"/),n=i[1];a(n)}else{l.extractAttributes=!0;var r=l.read(t);a(r)}};OpenLayers.Request.POST({url:e,data:p,headers:{"Content-Type":d},success:function(e){v(e)},failure:function(){OpenLayers.Console.error("...error..."),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_RetrievingFeature")),Utils.isNullOrUndefined(i)||i()}})}function displayAddWMSDialog(e){var t=$("<input>",{id:"addwms_url"}).attr("style","margin-left: 11px;width: 335px"),a=$("<div>").attr("style","padding: 10px 5px 5px 5px;").append(LocaleManager.getKey("AddWMSDialog_URL")).append(t),i={};i[LocaleManager.getKey("AlertDialog_Cancel")]=function(){$(this).dialog("close")},i[LocaleManager.getKey("AlertDialog_OK")]=function(){var t=$("#addwms_url").val();Utils.isNullOrUndefined(e)||e(t)};var n=DialogUtils.createDialog(LocaleManager.getKey("AddWMSDialog_Title"),i,{width:400,height:140},a);return n}function LegendGraphics(){}function AdvancedPanel(){}function MenuButtons(){}function buttonLineMeasureClicked(){var e=$("#gis_measureLineBtn").is(":checked");e?($("#gis_measureAreaBtn").prop("checked",!1),$("#gis_measureAreaBtn").button("refresh"),toggleMeasureControl("polygon",!1),showMeasureDialog(!0)):showMeasureDialog(!1),toggleMeasureControl("line",e)}function buttonPolygonMeasureClicked(){var e=$("#gis_measureAreaBtn").is(":checked");e?($("#gis_measureLineBtn").prop("checked",!1),$("#gis_measureLineBtn").button("refresh"),toggleMeasureControl("line",!1),showMeasureDialog(!0)):showMeasureDialog(!1),toggleMeasureControl("polygon",e)}function showMeasureDialog(e){var t=$("#gis_measures");e!==!0||t.is(":visible")||(t.text(""),t.show()),e===!1&&t.is(":visible")&&t.hide()}function toggleMeasureControl(e,t){var a=mapControls.measureControls;for(key in a){var i=a[key];e===key&&t?i.activate():i.deactivate()}}function writeAlternateMeasure(e,t,a){var i="";return""!==t&&(i=" ("+t.toFixed(3)+" "+e,2===a&&(i+="&sup2;"),i+=")"),i}function handleMeasurements(e){var t=e.units,a=e.order,i=e.measure,n="",r="";1===a&&"km"===t&&(n=t,r=i,i=1e3*i,t="m"),2===a&&"km"===t&&(n=t,r=i,i=100*i,t="hectares");var l="",o=writeAlternateMeasure(n,r,a);l+=1==a?LocaleManager.getKey("Measure_Panel_Measure_Text")+": "+i.toFixed(3)+" "+t+o:LocaleManager.getKey("Measure_Panel_Measure_Text")+": "+i.toFixed(3)+" "+t+o,$("#gis_measures").html(l)}function Print_Configuration(){}function AlertDialog(){}function CreateLayer(){}function LoadLayersUtils(){}function loadAll(){if(configLoaded===!0&&groupsConfigLoaded===!0){loadingDialog.close();var e=catalog.getMapConfig(),t=catalog.getToolConfig();OpenLayers.Control.DragPan.prototype.enableKinetic=!1,new OpenLayers.Bounds(e.maxExtent[0],e.maxExtent[1],e.maxExtent[2],e.maxExtent[3]);var a={projection:new OpenLayers.Projection(e.projection),units:e.units,zoomMethod:null,transitionEffect:null};map=new OpenLayers.Map("map",a);var i=new OpenLayers.Control.NavigationHistory;if(i.previous.events.register("activate",null,function(){handleNavigationButtons()}),i.previous.events.register("deactivate",null,function(){handleNavigationButtons()}),i.next.events.register("activate",null,function(){handleNavigationButtons()}),i.next.events.register("deactivate",null,function(){handleNavigationButtons()}),i.activate(),map.addControl(i),mapControls.navControl=i,map.events.register("moveend",map,function(){$("#input-label-panel").is(":visible")}),map.events.register("move",map,function(){print.onMouseMoveOnMapEventCallBackFn()}),map.events.register("addlayer",map,function(e){if(e.layer.alwaysOnTop!==!0){var t=map.getLayersBy("isBaseLayer",!0).length,a=map.getNumLayers(),i=map.getLayersBy("alwaysOnTop",!0).length;if(e.layer.isBaseLayer){var n=t-1;map.setLayerIndex(e.layer,n)}else{var r=map.getLayerIndex(e.layer);r>a-i-1&&map.setLayerIndex(e.layer,a-i-1)}}}),map.events.register("zoomend",map,function(){var e=map.getScale();$("#gis_current_scalebar").text(LocaleManager.getKey("Map_Current_Scale_Text")+" - 1:"+e.toFixed(0))}),t.mouseCoordinates.enabled){var n=t.mouseCoordinates.numDigits;map.events.register("mousemove",map,function(e){var t=this.events.getMousePosition(e);if(t=map.getLonLatFromPixel(e.xy),!Utils.isNullOrUndefined(t)&&(t.transform(map.getProjectionObject(),new OpenLayers.Projection("EPSG:32616")),$("#gis_coordinates").text("(Wgs84 /Utm 16N) X: "+t.lon.toFixed(n)+", Y: "+t.lat.toFixed(n)),null!=controls.redlines.instance&&controls.redlines.instance.modify.active&&1==redlines.vLayer.selectedFeatures.length&&$("#input-label-panel").is(":visible"))){var a=redlines.vLayer.selectedFeatures[0];Utils.locateInputLabelBox(a)}})}if(t.scalebar.enabled){var r=t.scalebar,l=r.displaySystem,o=r.divisions,s=r.subdivisions,c=r.singleLine,u=new OpenLayers.Control.ScaleBar({displaySystem:l,divisions:o,subdivisions:s,singleLine:c});map.addControl(u),mapControls.scaleBar=u}if(t.loadingPanel.enabled&&new OpenLayers.Control.LoadingPanel,t.measures.enabled){var d,g={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,handlerOptions:{layerOptions:{styleMap:styleMapMeasureControls}}}),polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,handlerOptions:{layerOptions:{styleMap:styleMapMeasureControls}}})};for(var p in g)d=g[p],d.events.on({measure:handleMeasurements,measurepartial:handleMeasurements}),map.addControl(d);mapControls.measureControls=g}LayerMenu.loadMenuGroups();var f=catalog.getLayerConfigs();if(LoadLayersUtils.loadLayersFromConfig(groups,f),zoomToDefaultMapCenter(),t.overview.enabled){gisOverview.showButton();var h=new OpenLayers.Bounds(-89.573364,12.961736,-82.827759,16.69934);h=h.transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject());var y=new OpenLayers.Layer.Image("Panoramica","./images/overview/mosef-m1103va002001_hn_overview.png",h,new OpenLayers.Size(300,150),{numZoomLevels:1,alwaysInRange:!0}),m={projection:new OpenLayers.Projection(e.projection),units:"m",numZoomLevels:1,maxExtent:h,restrictedExtent:h},v=new OpenLayers.Control.OverviewMap({div:document.getElementById("gis-map-overview"),size:new OpenLayers.Size(300,150),layers:[y],mapOptions:m});map.addControl(v)}searchResultPanel=new SearchResultPanel(map,{onclick:function(e){searchResultPanel.zoomToFeature(e)}})}}function zoomToDefaultMapCenter(){var e=catalog.getMapConfig();map.setCenter(new OpenLayers.LonLat(e.center[0],e.center[1]).transform(new OpenLayers.Projection(e.projection),map.getProjectionObject()),e.zoom)}function zoomToExtent(e,t){map.zoomToExtent(e,t)}function getGroupsConfig(e){try{$.ajax({url:Services.mapConfig,type:"GET",dataType:"json",cache:!1,data:{oper:"exportGroupConfigAsJson"}}).done(function(t){groups=t,groupsConfigLoaded=!0,e()}).fail(function(){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Configuration_Groups_Retrieve_Fail")),LocaleManager.getKey("Configuration_Groups_Retrieve_Fail")}).error(function(){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Configuration_Groups_Retrieve_Error")),LocaleManager.getKey("Configuration_Groups_Retrieve_Error")})}catch(t){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),t),t}}function getConfig(e){try{$.ajax({url:Services.mapConfig,type:"GET",dataType:"json",cache:!1,data:{oper:"exportMapConfigAsJson"}}).done(function(t){Utils.isNullOrUndefined(t.general.showInitialMessage)||t.general.showInitialMessage!==!0||AlertDialog.createOkDefaultDialog("Bienvenidos",t.general.initialMessage);var a=!1,i=!1,n=null,r=null;loadAllCapabilitiesFromConfig(t,function(l){n=l,a=!0,a&&i&&(catalog.loadConfigFromJSON(t,n,r),configLoaded=!0,e())}),loadAllDescribeFeatureFromConfig(t,function(l){r=l,i=!0,a&&i&&(catalog.loadConfigFromJSON(t,n,r),configLoaded=!0,e())})}).fail(function(){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Configuration_Retrieve_Fail")),LocaleManager.getKey("Configuration_Retrieve_Fail")}).error(function(){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Configuration_Retrieve_Error")),LocaleManager.getKey("Configuration_Retrieve_Error")})}catch(t){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),t),t}}function adjustTocHeight(){var e=$(window).height(),t=e-$("#toolbar").height()-$("#topbanner").height()-$("#footer").height()-100;if(gisOverview.isShown()){var a=$("#gis-map-overview").height();t-=a}$("#tab_toc").css("max-height",t+"px")}function init(){OpenLayers.ProxyHost=OL_PROXY_URL;try{loadingDialog.open("",LocaleManager.getKey("Loading")),getConfig(loadAll),getGroupsConfig(loadAll)}catch(e){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Configuration_Init_Error"))}}function submitLogin(){var e=$("#login_username").val(),t=$("#login_password").val();$.ajax({url:"login",type:"GET",dataType:"json",cache:!1,data:{oper:"login",username:e,password:t}}).done(function(e){e.success===!0?location.reload(!0):AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),e.msg)}).fail(function(e,t,a){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_LogIn")+a),"error login"})}function changeGlobalLanguage(e){var t=e.find(":selected").val();Utils.ajaxCall("./login","POST","json",{oper:"setLanguage",language:t},function(){LocaleManager.setLocale(t),LocaleManager.refreshLocale(),"es"===t?loadGeonetworkUrlInIframe(GEONETWORK_URL+"/srv/spa/main.home",!1):loadGeonetworkUrlInIframe(GEONETWORK_URL+"/srv/eng/main.home",!1)},function(){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Change_Language_Error"))})}function switchPage(e){var t=e.data("page");switchWebgisGNTabs(t)}function switchWebgisGNTabs(e){$(".webgisGNTabs").hide(),"tabs-gn"===e?$("body").find(".ui-dialog").addClass("geonetworkDialogHidden"):"tabs-webgis"===e&&$("body").find(".geonetworkDialogHidden").removeClass("geonetworkDialogHidden"),$("#"+e).show()}function handleNavigationButtons(){mapControls.navControl.next.active?$("#gis_nextBtn").removeClass("btn-disable"):$("#gis_nextBtn").addClass("btn-disable"),mapControls.navControl.previous.active?$("#gis_prevBtn").removeClass("btn-disable"):$("#gis_prevBtn").addClass("btn-disable")}function saveLabel(){null!=controls.redlines.instance&&(controls.redlines.instance.select.active||controls.redlines.instance.modify.active)&&redlines.saveLabel()}function addLayersFromGeoNetwork(e){for(var t=!1,a=0;e.length>a;a++){var i=e[a],n=i[0],r=i[1],l=i[2];i[3],0==t&&(switchWebgisGNTabs("tabs-webgis"),t=!0);var o=LayerMenu.getLayerLIFromMenu(r,n);Utils.isNullOrUndefined(o)?addSingleWMSLayerFromGeoNetwork(n,l,r):LayerMenu.selectAndOpenLayerInMenu(o)}}function addSingleWMSLayerFromGeoNetwork(e,t,a){doGetCapabilities(a,function(i){var n=checkIfSrsSupported(map.getProjection(),e,i);n?addWmsDialog.addLayerWMSToCatalogAndWebGIS(a,e,t,i):AlertDialog.createOkDefaultDialog(LocaleManager.getKey("GetCapabilities_SRS_Not_Supported_Error_Dialog_Title"),LocaleManager.getKey("GetCapabilities_SRS_Not_Supported_Error_Dialog_Text"))})}function loadGeonetworkUrlInIframe(e,t){$("#geonetwork-container-iframe").attr("src",e),t===!0&&switchWebgisGNTabs("tabs-gn")}function geonetworkLoaded(){var e=$("#geonetwork-container-iframe");try{var t=e.contents();if(!Utils.isNullOrUndefined(t)){var a=t.find("#geonetwork-header-to-be-removed");a.remove()}}catch(i){console.log("same policy error "+i)}$("#tabs-gn-switcher i").removeClass("fa-spinner"),$("#tabs-gn-switcher i").removeClass("fa-spin"),$("#tabs-gn-switcher i").addClass("fa-sitemap")}Services.mapConfig="./mapConfig",Services.layerConfig="./layerConfig",Services.comments="./comments",Services.getMapConfigUrl=function(){return Services.mapConfig},Services.getLayerConfigUrl=function(){return Services.layerConfig},Services.getCommentsUrl=function(){return Services.comments};var Sorting={refresh:function(e){$(e).sortable("refresh")},enable:function(e,t,a,i){$.each(e,function(e,n){Sorting.enableSort(n,t,a,i)})},enableSort:function(e,t,a,i){$(e).sortable({placeholder:"ui-state-targetsort",helper:"clone",items:t,sort:function(e,t){return t.item.data("tag")||t.item.data("handle")?void 0:(t.item.data("tag",!0),void 0)},stop:function(e,t){var i=t.item,n=t.item.index()+1;Utils.isNullOrUndefined(a)||a(i,n)}}),i&&$(e).sortable("option","axis",i),$(e).disableSelection()}},DragUtils={divClass:"drag-secure",activeClass:"drag-enable",buildDraggingPanel:function(){return $("<div>").attr("class",this.divClass)},addDragPanel:function(e){e.closest(".ui-dialog").append(this.buildDraggingPanel())},enable:function(e){0===e.closest(".ui-dialog").find("."+this.divClass).length&&this.addDragPanel(e),e.closest(".ui-dialog").find("."+this.divClass).addClass(this.activeClass)},disable:function(e){e.closest(".ui-dialog").find("."+this.divClass).removeClass(this.activeClass)}};jQuery.extend(jQuery.validator.messages,{required:"Validator_General_Message_Required",remote:"Please fix this field.",email:"Validator_General_Message_Email",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:jQuery.validator.format("Please enter no more than {0} characters."),minlength:jQuery.validator.format("Please enter at least {0} characters."),rangelength:jQuery.validator.format("Please enter a value between {0} and {1} characters long."),range:jQuery.validator.format("Please enter a value between {0} and {1}."),max:jQuery.validator.format("Please enter a value less than or equal to {0}."),min:jQuery.validator.format("Please enter a value greater than or equal to {0}.")});var Validate=function(e){var t=this;this.config=e,this.form=e.form,this.validator=null,this.activate=function(){this.validator=this.form.validate({messages:this.messages,errorClass:"validationErrorClass",highlight:function(e,t){$(e).addClass(t)},unhighlight:function(e,t){$(e).removeClass(t)},errorPlacement:function(e,a){var i=$(e[0]).text();t._removeButtonErrorValidate(a.parent().find(".btn-validate-error"));var n=null;a.height()>20&&(n=-(a.height()/2));var r=t._buildButtonErrorValidate(i,n);a.after(r),Utils.enableTooltip()}})},this._removeButtonErrorValidate=function(e){e.remove()},this._buildButtonErrorValidate=function(e,t){var a=$("<span>").attr({"class":"btn-validate-error localizedElement"}).data({locale_key:e,locale_ref:"title"});return a.append($("<i>").attr({"class":"fa fa-exclamation-triangle"})),t&&a.css({top:t}),a},this.valid=function(){return this.form.valid()},this.reset=function(){this.form.find(".validationErrorClass").removeClass("validationErrorClass"),this.form.find(".btn-validate-error").remove()},this.activate()};AjaxPrefilter.activateProxyFilter=function(e){$.ajaxPrefilter(function(t){if(t.crossDomain&&t.useProxy===!0){var a=t.url,i=t.data;a+=-1==t.url.indexOf("?")?"?"+i:"&"+i,t.url=e+encodeURIComponent(a),t.data="",t.crossDomain=!1}})};var globalStyles={redlines:{selectSymbolizer:{Point:{pointRadius:8,graphicName:"circle",fillColor:"#2E2EFE",fillOpacity:.4,strokeWidth:2,strokeColor:"#2E2EFE"},Line:{label:"${label}",strokeWidth:3,strokeOpacity:1,strokeColor:"#2E2EFE",strokeDashstyle:"solid"},Polygon:{strokeWidth:2,strokeColor:"#2E2EFE",fillColor:"#2E2EFE",fillOpacity:.4}},selectSymbolizerText:{Point:{label:"${label}",pointRadius:8,graphicName:"circle",fillColor:"#2E2EFE",fillOpacity:.4,strokeWidth:2,strokeColor:"#2E2EFE"},Line:{label:"${label}",strokeWidth:3,strokeOpacity:1,strokeColor:"#2E2EFE",strokeDashstyle:"solid"},Polygon:{label:"${label}",strokeWidth:2,strokeColor:"#2E2EFE",fillColor:"#2E2EFE",fillOpacity:.4}},defaultSymbolizer:{Point:{pointRadius:8,graphicName:"circle",fillColor:"#ee9900",fillOpacity:.4,strokeWidth:2,strokeColor:"#ee9900"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#ee9900",strokeDashstyle:"solid"},Polygon:{strokeWidth:2,strokeColor:"#ee9900",fillColor:"#ee9900",fillOpacity:.4}},defaultSymbolizerText:{Point:{label:"${label}",pointRadius:8,graphicName:"circle",fillColor:"#ee9900",fillOpacity:.4,strokeWidth:2,strokeColor:"#ee9900"},Line:{label:"${label}",strokeWidth:3,strokeOpacity:1,strokeColor:"#ee9900",strokeDashstyle:"solid"},Polygon:{label:"${label}",strokeWidth:2,strokeColor:"#ee9900",fillColor:"#ee9900",fillOpacity:.4}}}};StyleManager.getRedlineStyle=function(){var e=new OpenLayers.Style;e.addRules([new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"show",value:"yes"}),symbolizer:globalStyles.redlines.defaultSymbolizerText,elseFilter:!1}),new OpenLayers.Rule({symbolizer:globalStyles.redlines.defaultSymbolizer,elseFilter:!0})]);var t=new OpenLayers.Style;t.addRules([new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"show",value:"yes"}),symbolizer:globalStyles.redlines.selectSymbolizerText,elseFilter:!1}),new OpenLayers.Rule({symbolizer:globalStyles.redlines.selectSymbolizer,elseFilter:!0})]);var a=new OpenLayers.StyleMap({"default":e,select:t});return a},StyleManager.readSLD=function(e,t,a){$.ajax({url:"./sld/"+e,type:"GET",contentType:"text/xml",cache:!1}).done(function(e){var i=new OpenLayers.Format.SLD,n=i.read(e),r=n.namedLayers[t].userStyles;a(r)}).fail(function(){alert("fail")})},StyleManager.getDefaultStyle=function(e){for(var t=0;e.length>t;t++){var a=e[t];if(a.isDefault)return a}return null},StyleManager.getStyleByName=function(e,t){for(var a=0;e.length>a;a++){var i=e[a];if(i.name===t)return i}return null},DialogUtils.renderDialog=function(e,t,a,i){var n=700,r=350,l=!1,o=!0,s=!0;Utils.isNullOrUndefined(a)||(Utils.isNullOrUndefined(a.width)||(n=a.width),Utils.isNullOrUndefined(a.height)||(r=a.height),Utils.isNullOrUndefined(a.autoOpen)||(l=a.autoOpen),Utils.isNullOrUndefined(a.modal)||(o=a.modal),Utils.isNullOrUndefined(a.resizable)||(s=a.resizable));var c={autoOpen:l,title:e,modal:o,width:n,height:r,modal:o,resizable:s,close:function(){Utils.isNullOrUndefined(a.closeFn)||a.closeFn(),$(this).dialog("close")},buttons:t};a.dragsafe=!0,a.dragsafe===!0&&(c.dragStart=function(){DragUtils.enable($(this))},c.dragStop=function(){DragUtils.disable($(this))}),i.dialog(c);var u=!1;return Utils.isNullOrUndefined(a.collapsable)||(u=a.collapsable),Utils.isNullOrUndefined(a.extensions)||a.extensions!==!0||i.dialogExtend({minimizable:u}),i},DialogUtils.createDialog=function(e,t,a,i){var n=$("<div>",{title:e}),r=700,l=350,o=!1,s=!0,c=!0;Utils.isNullOrUndefined(a)||(Utils.isNullOrUndefined(a.width)||(r=a.width),Utils.isNullOrUndefined(a.height)||(l=a.height),Utils.isNullOrUndefined(a.autoOpen)||(o=a.autoOpen),Utils.isNullOrUndefined(a.modal)||(s=a.modal),Utils.isNullOrUndefined(a.resizable)||(c=a.resizable));var u={autoOpen:o,modal:s,width:r,height:l,resizable:c,close:function(){Utils.isNullOrUndefined(a.closeFn)||a.closeFn(),$(this).dialog("destroy").remove()},buttons:t};return a.dragsafe=!0,a.dragsafe===!0&&(u.dragStart=function(){DragUtils.enable($(this))},u.dragStop=function(){DragUtils.disable($(this))}),n.dialog(u),n.append(i),n},Utils.isNullOrUndefined=function(e){return null==e||e===void 0?!0:!1},Utils.isNotEmpty=function(e){return Utils.isNullOrUndefined(e)||""==$.trim(e)?!1:!0},Utils.isEmpty=function(e){return!Utils.isNotEmpty(e)},Utils.isInt=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},Utils.isFloat=function(e){return!isNaN(parseFloat(e))},Utils.isTrue=function(e){return Utils.isNullOrUndefined(e)||e!==!0?!1:!0},Utils.isInArrayAsBool=function(e,t){var a=$.inArray(e,t);return-1==a?!1:!0},Utils.isInArray=function(e,t,a){var i=!1;return t.length?-1!==$.inArray(e,t)&&(i=""+$.inArray(e,t)):$.each(t,function(t,n){return compare="key"===a?t:n,e===compare?(i=!0,!1):void 0}),i},Utils.isArray=function(e){var t=!1;return e.constructor===Array&&(t=!0),t},Utils.clone=function(e){if(null==e||"object"!=typeof e)return e;var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t},Utils.getFromWKT=function(e){var t=new OpenLayers.Format.WKT,a=t.read(e);return a},Utils.getGeomWKT=function(e){var t=new OpenLayers.Format.WKT,a=t.extractGeometry(e);return a},Utils.escapeNamespace=function(e){var t=e.indexOf(":")>-1?!0:!1;return t?e.split(":")[1]:e},Utils.EqualsNamespaceSafe=function(e,t){var a=e.indexOf(":")>-1?!0:!1,i=t.indexOf(":")>-1?!0:!1;if(!a&&!i){var n=e===t;return n}var n=Utils.escapeNamespace(e)===Utils.escapeNamespace(t);return n},Utils.getFeaturesFromList=function(e,t,a){var i=[];return $.each(e,function(e,n){if(!n.hasOwnProperty("wktGeometry")||null==n.wktGeometry)return!0;var r=Utils.getFromWKT(n.wktGeometry);if(!Utils.isNullOrUndefined(a))for(var l=0;a.length>l;l++){var o=a[l];n.hasOwnProperty(o)&&(r=Utils.addPropertyToFeature(r,o,n[o]))}Utils.isNullOrUndefined(t)||(r=Utils.addLabelToFeature(r,n[t])),i.push(r)}),i},Utils.getGeomType=function(e){switch(e){case"Point":return"point";case"Line":return"line";case"LineString":return"line";case"MultiLineString":return"line";case"Polygon":return"polygon";case"MultiPolygon":return"polygon"}},Utils.getGeomTypeForPrint=function(e){switch(e){case"Point":return"Point";case"Line":return"Line";case"LineString":return"Line";case"MultiLineString":return"Line";case"Polygon":return"Polygon";case"MultiPolygon":return"Polygon"}},Utils.createCloneFeature=function(e){var t=new OpenLayers.Feature.Vector(e.geometry.clone());return t},Utils.setAttributesFeature=function(e,t){return $.each(t,function(t,a){e.attributes[t]=a}),e},Utils.getFeatureLabel=function(e){return $.trim(e.attributes.label)},Utils.addLabelToFeature=function(e,t){return e.attributes.label=t,e.attributes.show="yes",e},Utils.addPropertyToFeature=function(e,t,a){return e.attributes[t]=a,e},Utils.getPixelFromMapCoords=function(e){var t=e.x,a=e.y,i=new OpenLayers.LonLat(t,a),n=map.getPixelFromLonLat(i);return n},Utils.formatStringWithLineBreaks=function(e,t){label=t.slice(0),label=label.replace(/ {2,}/g," ");for(var a="",i=label.slice(0),n=1,r=0;label.length>r;r++)" "===label[r]&&r>e*n&&(i=[i.slice(0,r+1),"\n",i.slice(r+1)].join(""),n+=1);return a=i},Utils.removeLabelInput=function(){$("#input-label").val(""),$("#input-label-panel").hide()},Utils.ajaxCallSynch=function(e,t,a,i,n,r){$.ajax({url:e,async:!1,type:t,dataType:a,data:i}).done(function(e){e.success?n(e):Utils.isNullOrUndefined(r)?AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),e.msg,"error"):r(e)}).fail(function(e,t,a){Utils.isEmpty(a)&&(a=LocaleManager.getKey("Ajax_General_Error")),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),a,"error")})},Utils.ajaxCall=function(e,t,a,i,n,r){$.ajax({url:e,type:t,dataType:a,data:i}).done(function(e){e.success?n(e):Utils.isNullOrUndefined(r)?AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),e.msg,"error"):r(e)}).fail(function(e,t,a){Utils.isEmpty(a)&&(a=LocaleManager.getKey("Ajax_General_Error")),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),a,"error")})},Utils.populateList=function(e,t,a,i,n){return $.each(t,function(){var t=$("<li>");t.addClass("ui-widget-content"),t.data(a,this[i]),t.text(this[n]),e.append(t)}),e},Utils.ComboSetSelectedValue=function(e,t,a){if(!Utils.isNullOrUndefined(t[a])){var i=e.find("option");$.each(i,function(e,i){return t[a]==$(i).attr("value")?($(i).prop("selected",!0),!1):void 0
})}},Utils.populateComboWithEmpty=function(e,t,a,i,n){e.empty(),Utils.populateCombo(e,t,a,i,n);var r=$("<option>",{value:"",text:""});e.prepend(r)},Utils.populateCombo=function(e,t,a,i,n){e.empty(),$.each(t,function(){var t=$("<option>",{value:this[a],text:this[i]});if(!Utils.isNullOrUndefined(n)&&Utils.isArray(n)&&n.length>0)for(var r=0;n.length>r;r++){var l=n[r],o=this[l];t.data(l,o)}e.append(t)})},Utils.getDefaultDbEPSG=function(){return"EPSG:4326"},Utils.getSelectedRow=function(e){var t=e.api().rows(".selected").data();return t.length>0?t:!1},Utils.getSelectedFeatures=function(e){var t=0;return $.each(e,function(e,a){"select"==a.renderIntent&&(t+=1)}),t},Utils.locateInputLabelBox=function(e){var t=e.geometry.getCentroid(),a=Utils.getPixelFromMapCoords(t);$("#input-label-panel").css({top:a.y+15,left:a.x+15}).show()},Utils.getMapCenterPoint=function(e){var t=e.getCenter(),a=new OpenLayers.Geometry.Point(t.lon,t.lat);return a},Utils.orderByAttribute=function(e,t,a){return e.sort(Utils.compareValues(t,a))},Utils.compareValues=function(e,t){var a=1;return"desc"===t&&(a=-1),function(t,i){var n=t[e]<i[e]?-1:t[e]>i[e]?1:0;return n*a}},Utils.enableTooltip=function(){$(document).tooltip({items:".localizedElement",content:function(){var e=$(this);if("title"==e.data("locale_ref")){var t=e.data("locale_key"),a=LocaleManager.getKey(t);return a}},show:{duration:50},hide:{duration:20}})},Utils.cleanForm=function(e){e&&($.each(e.find("input"),function(e,t){$(t).is(":checkbox")?$(t).prop("checked",!1):$(t).val("")}),$.each(e.find("textarea"),function(e,t){$(t).val("")}))},Utils.closeDialogForm=function(e){Utils.cleanForm(e),e.dialog("close")},Utils.moveDown=function(e){e.next().after(e)},Utils.moveUp=function(e){e.prev().before(e)},Utils.getPositionItem=function(e,t){var a=e.index(t);return a+1},CollapseExpandPanelUtils.expandPanel=function(e,t,a,i){e.removeClass("collapsed"),t.find(".fa-chevron-up").removeClass("fa-chevron-up").addClass("fa-chevron-down"),a.show();var n="300px";Utils.isNullOrUndefined(i)||(n=i),e.animate({height:n},100)},CollapseExpandPanelUtils.collapsePanel=function(e,t,a){e.addClass("collapsed"),t.find(".fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-up"),a.hide(),e.animate({height:"20px"},100)};var LoadingPanel=function(e,t,a){this._obj=e,this._text=t,this._isModal=a,this.CLASS_WHITE="loading-container-white",this.CLASS_NO_WHITE="loading-container",this.getLoading=function(){var e=this._text,t=$("<span class='loading-span'>"),a=$("<div>").attr("class",this.CLASS_WHITE).append($("<div>").attr("class","loading").append($("<div>").attr("class","txt-container").append(t,$("<span class='loading-text'>").text(e)),$("<div>").attr("class","img-container").append(t,$("<img>").attr("src","images/loading2.gif"))));return a},this.addLoading=function(){if(Utils.isTrue(this._isModal)){this._obj.find(".loading").length>0&&this.removeLoading();var e=this.getLoading();this._obj.prepend(e)}else{this._obj.hide();var e=this.getLoading();this._obj.before(e)}},this.removeLoading=function(){if(Utils.isTrue(this._isModal))this._obj.find(".loading-container-white").remove();else{var e=this._obj.siblings(".loading-container-white");e.remove(),this._obj.show()}}},loadingDialog={instance:null,panel:null,init:function(){null==this.panel&&(this.panel=$("#loading-panel")),null==this.instance&&(this.instance=this.panel.dialog({autoOpen:!1,dialogClass:"loading-dialog-panel",closeOnEscape:!1,draggable:!1,width:200,minHeight:100,modal:!0,buttons:{},resizable:!1,open:function(){$("body").css("overflow","hidden")},close:function(){$("body").css("overflow","auto")}}))},open:function(e,t){this.init();var a=$("<div>").attr({"class":"image-loading"}).append($("<img>").attr({src:"images/loading2.gif"})),i=$("<div>").attr({"class":"text-loading"}).text(t),n=$("<div>").attr({"class":"loading-content"}).append(i,a);this.panel.html(n),this.panel.dialog("option","title",e),this.panel.dialog("open")},close:function(){null!=this.instance&&this.panel.dialog("close")}},loadingImage=function(e,t){if(t){if(e){var a=$("<div>").attr({"class":"image-loading-panel"}).append($("<img>").attr({src:"images/loading2.gif"}));e.append(a)}}else e.find(".image-loading-panel").remove()};UserPermission.prototype.hasPermission=function(e){if(!Utils.isNullOrUndefined(this.userPermission))for(var t=0;this.userPermission.permissions.length>t;t++)if(this.userPermission.permissions[t]===e)return!0;return!1},LayerConfig.prototype.getId=function(){return this.layerConfig.id},LayerConfig.prototype.getPosition=function(){return this.layerConfig.position},LayerConfig.prototype.getSource=function(){return this.layerConfig.source},LayerConfig.prototype.getCapabilities=function(){return this.layerConfig.capabilities},LayerConfig.prototype.getTitle=function(){return this.layerConfig.title},LayerConfig.prototype.getName=function(){return this.layerConfig.name},LayerConfig.prototype.getDescription=function(){return this.layerConfig.description},LayerConfig.prototype.getResponsible=function(){return this.layerConfig.responsible},LayerConfig.prototype.isExternal=function(){var e=!0;return Utils.isNullOrUndefined(this.layerConfig.external)||(e=this.layerConfig.external),e},LayerConfig.prototype.getBounds=function(){return this.layerConfig.bounds},LayerConfig.prototype.getUrl=function(){return this.layerConfig.url},LayerConfig.prototype.getCacheUrl=function(){return this.layerConfig.cacheUrl},LayerConfig.prototype.getSldUrl=function(){return this.layerConfig.sldUrl},LayerConfig.prototype.getGroup=function(){return this.layerConfig.group},LayerConfig.prototype.isEnabled=function(){return this.layerConfig.enabled},LayerConfig.prototype.getOpenLayersOptions=function(){return this.layerConfig.olOptions},LayerConfig.prototype.getWMSOptions=function(){return this.layerConfig.wmsOptions},LayerConfig.prototype.getFormat=function(){return this.layerConfig.wmsOptions.format},LayerConfig.prototype.getAttributeNameForInfo=function(){return this.layerConfig.attributeNameForInfo},LayerConfig.prototype.getSection=function(){return this.layerConfig.section},LayerConfig.prototype.isWFSGetFeatureAvailable=function(){return this.layerConfig.WFSGetFeatureAvailable},LayerConfig.prototype.setWFSGetFeatureAvailable=function(e){this.layerConfig.WFSGetFeatureAvailable=e},LayerConfig.prototype.setAttributesNotAvailableCause=function(e){this.layerConfig.setAttributesNotAvailableCause=e},LayerConfig.prototype.getAttributesNotAvailableCause=function(){return this.layerConfig.getAttributesNotAvailableCause},LayerConfig.prototype.setAttributesAvailable=function(e){this.layerConfig.attributesAvailable=e},LayerConfig.prototype.isAttributesAvailable=function(){return this.layerConfig.attributesAvailable},LayerConfig.prototype.getAttributes=function(){return this.layerConfig.attributes},LayerConfig.prototype.setAttributes=function(e){return this.layerConfig.attributes=e},LayerConfig.prototype.getDefaultOpacity=function(){var e=this.getOpenLayersOptions();return Utils.isNullOrUndefined(e)?null:e.opacity},LayerConfig.prototype.getBbox=function(e){var t={};if(!Utils.isNullOrUndefined(this.getCapabilities())){var a=this.getCapabilities().capability;return $.each(a.layers,function(a,i){return e===i.name?(i.llbbox[0]&&""!=i.llbbox[0]&&(t.minx=i.llbbox[0]),i.llbbox[1]&&""!=i.llbbox[1]&&(t.miny=i.llbbox[1]),i.llbbox[2]&&""!=i.llbbox[2]&&(t.maxx=i.llbbox[2]),i.llbbox[3]&&""!=i.llbbox[3]&&(t.maxy=i.llbbox[3]),!1):void 0}),t}return"kml"===this.getSource()?this.getBounds():void 0},LayerConfig.prototype.hasLegend=function(){var e=!1;return("wms"===this.layerConfig.source||"wms_multi_layer"===this.layerConfig.source)&&(e=!0),e},LayerConfig.prototype.isReferenceLayerForAlert=function(){var e=!1;return this.layerConfig.referenceLayerForAlerts===!0&&(e=!0),e},LayerConfig.prototype.exportToJson=function(){var e={},t=["source","title","url","name","enabled","wmsOptions","olOptions","group","layerData"];return $.each(this.layerConfig,function(a,i){Utils.isInArrayAsBool(a,t)&&(e[a]=i)}),e},WMSMultiLayerConfig.prototype=Object.create(LayerConfig.prototype),WMSMultiLayerConfig.prototype.getTitle=function(){return null},WMSMultiLayerConfig.prototype.getName=function(){return null},WMSMultiLayerConfig.prototype.isEnabled=function(){return null},WMSMultiLayerConfig.prototype.getWMSOptions=function(){return this.layerConfig.wmsOptions},WMSMultiLayerConfig.prototype.getWMSOptions=function(){return this.layerConfig.wmsOptions},WMSMultiLayerConfig.prototype.getLayerData=function(){return this.layerConfig.layerData},WMSMultiLayerConfig.prototype.getLayerDataByLayerName=function(e){var t=null;return $.each(this.layerConfig.layerData,function(a,i){var n=$.trim(i.name);return e===n?(t=i,!1):void 0}),t},WMSMultiLayerConfig.prototype.getEnabledLayerNamesForWMSMulti=function(){var e="",t=0;return $.each(this.layerConfig.layerData,function(a,i){var n=$.trim(i.name),r=i.enabled;Utils.isTrue(r)&&(t>0&&(e+=","),e+=n,t++)}),e},WMSMultiLayerConfig.prototype.getAllLayerNamesForWMSMulti=function(){var e="",t=0;return $.each(this.layerConfig.layerData,function(a,i){var n=$.trim(i.name);t>0&&(e+=","),e+=n,t++}),e},WMSMultiLayerConfig.prototype.getAllLayerNamesAsListForWMSMulti=function(){var e=[];return $.each(this.layerConfig.layerData,function(t,a){var i=$.trim(a.name);e.push(i)}),e},WMSMultiLayerConfig.prototype.getAttributes=function(e){var t=this.getLayerDataByLayerName(e);return t.attributes},WMSMultiLayerConfig.prototype.setAttributesForLayer=function(e,t){var a=this.getLayerDataByLayerName(t);a.attributes=e},WMSMultiLayerConfig.prototype.getNameByTitle=function(e){var t=null;return $.each(this.layerConfig.layerData,function(a,i){var n=$.trim(i.title);return $.trim(e)===n?(t=i.name,void 0):void 0}),t},LayerInfoDialog.populateInformationDiv=function(e,t){var a=t.getTitle();e.find("#layer_info_template_title").text(a);var i=t.getDescription();if(e.find("#layer_info_template_description").text(i),t.hasLegend()===!0){var n=t.getUrl(),r=t.getName(),l=LegendGraphics.getLegendImageLayer(n,r);l.show(),e.find("#layer_info_template_legend_container").append(l)}else e.find("#layer_info_template_legend_container").addClass("custom-hidden");var o=t.getResponsible();e.find("#layer_info_template_responsible_value").text(o);var s=t.getUrl();e.find("#layer_info_template_wms_value").text(s);var c=t.getName();e.find("#layer_info_template_name_value").text(c),$.each(e.find(".localizedElement"),function(){var e=$(this);LocaleManager.refreshLocalizedElement(e)})},LayerInfoDialog.showLayerInfo=function(e){var t=catalog.getLayerConfigById(e),a=$("<div>");a.load("layer_info_template.html",function(){LayerInfoDialog.populateInformationDiv(a,t);var e=DialogUtils.createDialog("Informaciones",null,{width:490,height:250},a);e.dialog("open")})};var TreeMenu=function(e){this.parent=e,this.createNewGroupInMenu=function(e,t){var a=this.getGroupFromMenuByCode(e);return null==a&&(a=this.buildNewGroupDIV(e,t),this.parent.append(a)),a},this.buildNewGroupDIV=function(e,t){var a=$("<div>",{id:"menu_"+e,"class":"root_item"}).data("grp_code",e),i=this,n=$("<div>",{"class":"menu_title"}).click(function(){i.toggleMenuItemContent($(this).parents(".root_item"))}),r=this.buildIconGroupTree(),l=$("<div>").addClass("root_text").text(t);n.append(r,l);var o=$("<div>").addClass("menu_item_content custom-hidden").append($("<ul>").addClass("menu_item_content_list"));return a.append(n,o),a},this.buildIconGroupTree=function(){var e=$("<span>").attr({"class":"fa-stack root-tree-icon"}).append($("<i>").attr({"class":"fa fa-plus fa-stack-1x"}),$("<i>").attr({"class":"fa fa-circle-thin fa-stack-2x"}));return e},this.getGroupFromMenuByCode=function(e){var t=null,a=this.parent.find(".root_item");return $.each(a,function(a,i){var n=$(i).data("grp_code");return e===n?(t=i,!1):void 0}),t},this.prependElementToGroup=function(e,t){var a=this.getParentElementByCode(e);a.prepend(t)},this.getParentElementByCode=function(e){var t=null,a="#menu_"+e+" .menu_item_content_list";return t=$(a)},this.getNumberOfChildrenOfGroupDIV=function(e){var t=e.find("li");return t.length},this.isGroupExpanded=function(e){var t=e.find(".menu_item_content"),a=t.is(":visible");return a},this.toggleMenuItemContent=function(e){var t=this.isGroupExpanded(e);t?TreeMenu.collapseRootItem(e):TreeMenu.expandRootItem(e)},this.getGroupDIVFromLayer=function(e){return e.closest(".root_item")},this.getAllLayers=function(){var e=this.parent.find(".layerMenuItem");return 0==e.length?null:e},this.getAllLayersSize=function(){var e=this.parent.find(".layerMenuItem");return e.length},this.getSelectedLayer=function(){var e=this.parent.find(".layerMenuItem.selected");return 0==e.length?null:e},this.getVisibleLayers=function(){var e=this.parent.find(".layerMenuItem.enabled");return 0==e.length?null:e},this.getItemByDataProperty=function(e,t){var a=null,i=this.getAllLayers();return $.each(i,function(i,n){var r=$(n).data(e);return t===r?(a=$(n),!1):!0}),a}};TreeMenu.collapseRootItem=function(e){var t=e.find(".menu_item_content");t.hide("fast");var a=e.find(".root-tree-icon .fa-stack-1x");a.removeClass("fa-minus"),a.addClass("fa-plus")},TreeMenu.expandRootItem=function(e){var t=e.find(".menu_item_content");t.show("fast");var a=e.find(".root-tree-icon .fa-stack-1x");a.removeClass("fa-plus"),a.addClass("fa-minus")},TreeMenu.isItemMenuEnabled=function(e){return e.hasClass("enabled")},TreeMenu.enableItemMenu=function(e){TreeMenu.isItemMenuEnabled(e)||TreeMenu.toggleItemMenuEnabling(e,!0)},TreeMenu.toggleItemMenuEnabling=function(e,t){t===!0&&e.addClass("enabled"),t===!1&&e.removeClass("enabled")},TreeMenu.isItemMenuSelected=function(e){return e.hasClass("selected")},TreeMenu.toggleItemMenuSelection=function(e,t){t===!0&&e.addClass("selected"),t===!1&&e.removeClass("selected")},TreeMenu.isItemAdded=function(e){return e.hasClass("added")},TreeMenu.toggleItemMenuAddition=function(e,t){t===!0&&e.addClass("added"),t===!1&&e.removeClass("added")},LayerMenuUtils.buildLayerMenuItem_NEW=function(e){var t=e.title,a=e.deleteBtn,i=e.addZoomBtn,n=e.isExternal,r=e.zoomToClickedFn,l=e.layerMenuItemClickedFn,o=e.showInfoBtn,s=e.infoBtnClickedFn,c=$("<div>").attr("class","menu-actions");Utils.isNullOrUndefined(a)||c.append(a),i===!0&&c.append(LayerMenuUtils.buildZoomToLayerButton(r)),o===!0&&c.append(LayerMenuUtils.buildShowInfoLayerButton(s));var u="item-text word-wrap";n&&(u+=" externalWMS");var d=$("<div>").attr("class",u).text(t),g=$("<li>").attr({"class":"layerMenuItem"}).append($("<div>").attr({"class":"item-layer"}).append(d,c).click(function(e){Utils.isNullOrUndefined(l)||l($(this),e)}));return g},LayerMenuUtils.buildLayerMenuItemForWMSMulti=function(e,t,a){var i=$("<li>").attr({"class":"layerMenuItem"}).append($("<div>").attr("class","item-text word-wrap").text(e),$("<div>").attr("class","menu-actions").append($("<div>").append(deleteButton,LayerMenuUtils.buildZoomToLayerButton(a))),LayerMenuUtils.buildToggleLegendImgBtn(!0));return i},LayerMenuUtils.buildTransparencyDIV=function(e,t){var a="",i=!1;"wms_multi_layer"==e.getSource()&&(a="item-transparency-multi",i=!0);var n=$("<div>").attr({"class":"item-transparency "+a}),r=$("<div>").attr({"class":"item-transparency-text"}).text(LocaleManager.getKey("Page_Menu_Transparency_Label")),l=$("<div>").attr({"class":"item-slider-container"}),o=$("<div>").attr({"class":"item-slider-transparency"});return o.slider({max:10,min:0,step:1,slide:function(t,a){var i=null;i="wms_multi_layer"==e.getSource()?$(this).closest(".root_item").find("li:first").data("layerOL"):$(this).closest("li").data("layerOL"),i&&i.setOpacity(a.value/10)}}).click(function(e){e.stopPropagation()}),l.append(o),Utils.isNullOrUndefined(e.getDefaultOpacity())?o.slider("value",10):o.slider("value",10*e.getDefaultOpacity()),i?n.append(r,l):t===!0?n.append(r,LayerMenuUtils.buildToggleLegendImgBtn(),l):n.append(r,l),n},LayerMenuUtils.buildToggleLegendImgBtn=function(e){var t="";e&&(t="item-toggle-legend-multi");var a=$("<div>").attr("class","item-toggle-legend localizedElement "+t).data({locale_ref:"title",locale_key:"showLegend"}).append($("<i>").attr({"class":"fa fa-photo fa-lg"})).click(function(){LayerMenuUtils.toggleLegend($(this).closest("li").find(".legendItem"))});return a},LayerMenuUtils.toggleLegend=function(e){e.is(":visible")?(e.hide(),e.closest("li").find(".item-toggle-legend").data({locale_key:"showLegend"})):(e.show(),e.closest("li").find(".item-toggle-legend").data({locale_key:"hideLegend"}))},LayerMenuUtils.buildShowInfoLayerButton=function(e){var t=$("<span>").data({locale_ref:"title",locale_key:"TOC_Layers_Show_Layer_Info_Panel"}).attr("class","localizedElement").append($("<i>").attr({"class":"fa fa-info-circle"})).click(function(t){Utils.isNullOrUndefined(e)||e($(this),t)});return t},LayerMenuUtils.buildDeleteLayerButton=function(e){var t=$("<span>").data({locale_ref:"title",locale_key:"TOC_Layers_Remove_From_Selected_Panel"}).attr("class","localizedElement").append($("<i>").attr({"class":"fa fa-trash-o"})).click(function(t){Utils.isNullOrUndefined(e)||e($(this),t)});return t},LayerMenuUtils.buildZoomToLayerButton=function(e){var t=$("<span>").data({locale_ref:"title",locale_key:"General_ZoomToLayer_Button_Title"}).attr("class","localizedElement").append($("<i>").attr({"class":"fa fa-search"})).click(function(t){Utils.isNullOrUndefined(e)||e($(this),t)});return t},LayerMenuUtils.createLayerSelectedMenuToggleVisibilityCheckbox=function(e){var t=$("<input>").attr("type","checkbox").prop("checked",!0).addClass("toggleLayerCheckbox");return t.click(function(t){Utils.isNullOrUndefined(e)||e($(this),t)}),t},LayerMenuUtils.createLayerMenuCheckboxForAdd=function(e){var t=$("<input>").attr("type","checkbox").addClass("addLayerCheckbox").data({locale_key:"TOC_Layers_Add_To_Selected_Panel",locale_ref:"title"});return t.change(function(t){Utils.isNullOrUndefined(e)||e($(this),t)}),t},LayerMenu.groups=null,LayerMenu.addToBaseLayersMenu=function(e,t){var a=$("#baselayers-select");return a.append($("<option/>",{value:e.getId(),text:e.getTitle()}).data({layerOl:t,enabled:e.isEnabled()})),!0},LayerMenu.isBackgroundGroup=function(e){var t=!1,a=!1;if($.each(groups.layersGroups,function(i,n){n.code===e&&(t=n.background,a=!0)}),a)return t;throw"GROUP "+e+"NOT FOUND! ERROR!"},LayerMenu.getSelectedBasemapLayer=function(){var e=$("#baselayers-select option:selected"),t=parseInt(e.val());return catalog.getLayerConfigById(t)},LayerMenu.getSelectedBasemapLayerTitle=function(){var e=$("#baselayers-select option:selected");return e.text()},LayerMenu.toggleMenu=function(e){e.hasClass("expanded")?(e.find("i").removeClass("fa-caret-right").addClass("fa-caret-left"),e.removeClass("expanded"),$("#menu_header").hide(),$("#menu_tabs").hide(),$("#rightPanel").animate({width:"0px"},100)):(e.addClass("expanded"),e.find("i").removeClass("fa-caret-left").addClass("fa-caret-right"),$("#rightPanel").animate({width:"395px"},100,function(){$("#menu_header").show(),$("#menu_tabs").show()}))},LayerMenu.switchTabMenu=function(e){$(".menu-tab-switcher-item").removeClass("menu-tab-active"),e.addClass("menu-tab-active");var t=e.data("tab");$(".tab-item").addClass("custom-hidden"),$("#"+t).removeClass("custom-hidden")},LayerMenu.loadMenuGroups=function(){var e=Utils.orderByAttribute(groups.layersGroups,"position","asc");$.each(e,function(e,t){var a=t.name,i=t.code,n=t.title,r=LayerMenu.isBackgroundGroup(i);if(r)return!0;var l=catalog.existsLayerForGroup(a);return l?(tree.createNewGroupInMenu(i,n),void 0):!0})},LayerMenu._addToSelectedLayerPanel=function(e){var t=TreeMenu.isItemAdded(e);if(t!==!0){var a=selectedLayerTree.getAllLayersSize();if(a+1>GLOBAL_SETTINGS.maxNumberOfSelectedLayers)return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("Page_Menu_Selected_Layers_Max_Size")),void 0;TreeMenu.toggleItemMenuAddition(e,!0);var i=e.data("layerOL"),n=e.data("id");i.setVisibility(!0),map.addLayer(i),LayerMenu.addToSelectedLayerMenu({id:n,layerOL:i,enabled:!0,hasDelete:!0,hasLegend:!1})}},LayerMenu._singleLayerChecked=function(e){var t=e.data("layerOL"),a=TreeMenu.isItemMenuEnabled(e);a?(TreeMenu.toggleItemMenuEnabling(e,!1),TreeMenu.toggleItemMenuSelection(e,!1)):TreeMenu.toggleItemMenuEnabling(e,!0),e.find(".toggleLayerCheckbox"),t.setVisibility(!a)},LayerMenu._singleLayerClicked=function(e){var t=TreeMenu.isItemMenuEnabled(e),a=TreeMenu.isItemMenuSelected(e);if(t===!0){if(controls.deactivate(controls.WMSGetFeatureInfo),a)return TreeMenu.toggleItemMenuSelection(e,!1),void 0;$(selectedLayerTree.getSelectedLayer()).each(function(){TreeMenu.toggleItemMenuSelection($(this),!1)}),TreeMenu.toggleItemMenuSelection(e,!0)}},LayerMenu._wmsMultiLayerChecked=function(e){var t=TreeMenu.isItemMenuEnabled(e);t?TreeMenu.toggleItemMenuEnabling(itemMenu,!1):TreeMenu.toggleItemMenuEnabling(itemMenu,!0);var a=e.data("layerOL"),i=e.data("title"),n=e.data("id"),r=catalog.getLayerConfigById(n),l=r.getNameByTitle(i),o=a.params.LAYERS,s=null;s=""===o?[]:o.split(",");var c=$.inArray(l,s);-1!==c?s.splice(c,1):s.push(l);var u=s.join(",");0>=s.length?a.setVisibility(!1):a.setVisibility(!0),a.mergeNewParams({layers:u})},LayerMenu.showLayerInfoClickFn=function(e,t){t.stopPropagation();var a=e.closest("li"),i=$(a).data("id");LayerInfoDialog.showLayerInfo(i)},LayerMenu.addToMenu=function(e,t){var a=e.getGroup(),i=tree.getParentElementByCode(a);if(null==i)return alert("no element in the menu called "+a),void 0;var n=!0;Utils.isNullOrUndefined(e.isExternal())||(n=e.isExternal());var r=LayerMenuUtils.buildLayerMenuItem_NEW({title:e.getTitle(),deleteBtn:null,addZoomBtn:!1,isExternal:n,zoomToClickedFn:null,layerMenuItemClickedFn:null,showInfoBtn:!0,infoBtnClickedFn:LayerMenu.showLayerInfoClickFn}),l=LayerMenuUtils.createLayerMenuCheckboxForAdd(function(e,t){t.stopPropagation();var a=!0;if($(e).is(":checked")&&(a=!1),a===!0){var i=TreeMenu.isItemAdded(r);if(i===!1)return;var n=$(r).data("id"),l=selectedLayerTree.getItemByDataProperty("id",n);LayerMenu._removeFromSelectedLayerPanel(l)}else LayerMenu._addToSelectedLayerPanel(r)});return r.find(".item-layer").prepend(l),r.data({layerOL:t,title:e.getTitle(),id:e.getId()}),TreeMenu.toggleItemMenuEnabling(r,!0),tree.prependElementToGroup(a,r),r},LayerMenu.initOrderingSelectedLayerPanel=function(){var e=$("#menu_layers_active .menu_item_content_list");Sorting.enable(e,".layerMenuItem",function(e,t){var a=map.getLayersBy("isBaseLayer",!0).length,i=e.data("layerOL"),n=selectedLayerTree.getAllLayers(),r=n.length,l=r-t;map.setLayerIndex(i,l+a)},"y")},LayerMenu.addToSelectedLayerMenu=function(e){var t=e.id,a=e.layerOL,i=e.enabled,n=e.hasDelete,r=e.hasLegend,l=catalog.getLayerConfigById(t),o=$("#menu_layers_active .menu_item_content_list");if(null==o)return alert("no element in the menu called "),void 0;var s=null;n&&(s=LayerMenuUtils.buildDeleteLayerButton(function(e,t){t.stopPropagation();var a=e.closest("li"),i=a.data("id"),n=tree.getItemByDataProperty("id",i);if(Utils.isNullOrUndefined(n))alert("item in global menu NOT found, remove from selected!"),LayerMenu._removeFromSelectedLayerPanel(a);else{var r=n.find(".addLayerCheckbox");r.prop("checked",!1).change()}}));var c=!0;Utils.isNullOrUndefined(l.isExternal())||(c=l.isExternal());var u=LayerMenuUtils.buildLayerMenuItem_NEW({title:l.getTitle(),deleteBtn:s,addZoomBtn:!0,isExternal:c,zoomToClickedFn:function(e,t){t.stopPropagation();var a=e.closest("li");TreeMenu.isItemMenuEnabled(a)&&LayerMenu.zoomToLayer(a.data("id"),a.data("title"))},layerMenuItemClickedFn:function(e,t){t.stopPropagation();var a=e.closest("li");LayerMenu._singleLayerClicked(a)},showInfoBtn:!0,infoBtnClickedFn:LayerMenu.showLayerInfoClickFn}),d=LayerMenuUtils.buildTransparencyDIV(l,r);u.append(d),r&&u.append(LegendGraphics.getLegendImageLayer(l.getUrl(),l.getName())),i&&TreeMenu.toggleItemMenuEnabling(u,!0);var g=LayerMenuUtils.createLayerSelectedMenuToggleVisibilityCheckbox(function(e,t){t.stopPropagation(),LayerMenu._singleLayerChecked(u)});return u.find(".item-layer").prepend(g),u.data({layerOL:a,title:l.getTitle(),id:l.getId()}),o.prepend(u),Sorting.refresh(o),u},LayerMenu.addMultiLayerToMenu=function(e,t,a){var i=e.getGroup(),n=getParentElement(i);if(null!=n){var r=e.getLayerData();$.each(r,function(i,r){var l=!1;Utils.isTrue(r.enabled)&&(l=!0);var o=null;a&&(o=LayerMenuUtils.buildDeleteLayerButton(function(e,t){t.stopPropagation();var a=e.closest("li");deleteLayer(a)}));var s=LayerMenuUtils.buildLayerMenuItemForWMSMulti(r.title,o,function(e,t){t.stopPropagation();var a=e.closest("li");TreeMenu.isItemMenuEnabled(a)&&LayerMenu.zoomToLayer(a.data("id"),a.data("title"))});l&&TreeMenu.toggleItemMenuEnabling(s,!0),s.click(function(e){e.stopPropagation(),LayerMenu._singleLayerClicked($(this))});var c=LayerMenuUtils.createLayerSelectedMenuToggleVisibilityCheckbox(function(e,t){t.stopPropagation(),LayerMenu._wmsMultiLayerChecked(s)});s.prepend(c),s.data({layerOL:t,title:r.title,id:e.getId()});var u=e.getNameByTitle(r.title);s.append(LegendGraphics.getLegendImageLayer(e.getUrl(),u)),n.append(s)});var l=LayerMenuUtils.buildTransparencyDIV(e);n.prepend(l)}},LayerMenu.selectAndOpenLayerInMenu=function(e){var t=tree.getGroupDIVFromLayer($(e));TreeMenu.expandRootItem($(t));var a=$(e),i=TreeMenu.isItemAdded(a);if(i){var n=a.data("id"),r=a.data("layerOL"),l=selectedLayerTree.getItemByDataProperty("id",n);TreeMenu.toggleItemMenuEnabling(l,!0),r.setVisibility(!0),l.find(".toggleLayerCheckbox").prop("checked",!0)}else{var o=a.find(".addLayerCheckbox");o.prop("checked",!0).change()}},LayerMenu.getLayerLIFromMenu=function(e,t){var a=null,i=tree.getAllLayers();return $.each(i,function(i,n){var r=$(n).data("id"),l=catalog.getLayerConfigById(r);return l.getUrl()===e&&(layerConfigName="wms_multi_layer"==l.getSource()?l.getNameByTitle(l.getTitle()):l.getName(),Utils.EqualsNamespaceSafe(layerConfigName,t))?(a=n,!1):void 0}),a},LayerMenu.zoomToLayer=function(e,t){var a=catalog.getLayerConfigById(e),i=null;"wms_multi_layer"===a.getSource()?i=a.getNameByTitle(t):"wms"===a.getSource()&&(i=a.getName());var n=a.getBbox(i);if("kml"===a.getSource())return map.zoomToExtent(n),void 0;var r=new OpenLayers.Projection("EPSG:4326"),l=new OpenLayers.Projection(map.getProjection());if(n.hasOwnProperty("minx")&&n.hasOwnProperty("miny")&&n.hasOwnProperty("maxx")&&n.hasOwnProperty("maxy")){var o=new OpenLayers.Bounds(n.minx,n.miny,n.maxx,n.maxy);bounds=o.transform(r,l),map.zoomToExtent(bounds)}else AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Error_RetrievingBbox"))},LayerMenu._removeFromSelectedLayerPanel=function(e){var t=e.data("id"),a=e.data("layerOL"),i=tree.getItemByDataProperty("id",t);return Utils.isNullOrUndefined(i)?catalog.removeLayerFromConfig(t):(TreeMenu.toggleItemMenuAddition(i,!1),a.setVisibility(!1)),map.removeLayer(a),e.remove(),!0};var DescribeFeatureParser=function(e){this._obj=e,this.getDescribeFeatureConfig=function(e){var t=[],a=this.getFeatureTypeByName(e);return Utils.isNullOrUndefined(a)||$.each(a.properties,function(e,a){var i={};i.name=a.name,i.type=a.localType,t.push(i)}),t},this.getFeatureTypeByName=function(e){var t=null;return $.each(this._obj.featureTypes,function(a,i){return i.typeName===e?(t=i,!1):void 0}),t}},featureGridPanel=null,FeatureGridPanel=function(){var e=this;this.parent=$("#feature-grid-panel");var t={closeFn:function(){e.closeCallBackFn()},height:350,width:1e3,resizable:!1,modal:!1,extensions:!0,collapsable:!0};this.dialogDiv=DialogUtils.renderDialog(LocaleManager.getKey("FeatureGridPanel_Search_Header"),{},t,this.parent),this.gridContainer=$("#feature-grid-panel-grid-container"),this.panelToolbar=$("#feature-grid-panel-toolbar"),this.zoomToBtn=$("#feature-grid-panel-toolbar-zoomto").button(),this.table=null,this.dataTable=null,this.layerId=null,this.featureList=null,this.vLayer=null,this.closeCallBackFn=function(){this.destroyAll()},this.closePanel=function(){this.dialogDiv.dialog("close")},this.destroyAll=function(){Utils.isNullOrUndefined(this.dataTable)||this.dataTable.api().destroy(!0),this.dialogDiv.dialog("option","title",""),this.gridContainer.empty(),this.featureList=null,this.layerId=null,null!=this.vLayer&&this.vLayer.removeAllFeatures(),this.hideMaxFeatureReachedAlert(),this.toggleToolbarButtonsVisibility(!1)},this.toggleToolbarButtons=function(e){e===!0?this.zoomToBtn.button("enable"):this.zoomToBtn.button("disable")},this.toggleToolbarButtonsVisibility=function(e){e===!0?this.zoomToBtn.show():this.zoomToBtn.hide()},this.endLoading=function(){this.gridContainer.empty()},this.showMaxFeatureReachedAlert=function(){$("#feature-grid-panel-max-number-of-feature-reached").text(LocaleManager.getKey("FeatureGridPanel_Search_MaxNoResultReached"))},this.hideMaxFeatureReachedAlert=function(){$("#feature-grid-panel-max-number-of-feature-reached").empty()},this.show=function(){this.dialogDiv.dialog("open")},this.startLoading=function(t,a,i,n,r){if(this.show(),this.destroyAll(),null==this.vLayer){var l=new OpenLayers.Layer.Vector("search_result_vector",{displayInLayerSwitcher:!1,styleMap:StyleManager.getRedlineStyle(),projection:new OpenLayers.Projection(map.getProjection()),print:!1});map.addLayer(l),this.vLayer=l}this.dialogDiv.dialog("option","title",LocaleManager.getKey("FeatureGridPanel_Search_Header")+": "+a);var o=$("<div>").attr("class","featureGridPanelLoadingContainer").append($("<img>").attr("src","images/loading2.gif"));this.gridContainer.append(o),GLOBAL_SETTINGS.searchMaxResultForLayer>0&&(i.searchOptions.maxFeatures=GLOBAL_SETTINGS.searchMaxResultForLayer);var s=new Search,c=this;s.searchLayer(i.url,i.layerName,!1,i.layerAttributeList,i.searchTerm,i.searchOptions,function(a){GLOBAL_SETTINGS.searchMaxResultForLayer>0&&n>GLOBAL_SETTINGS.searchMaxResultForLayer&&e.showMaxFeatureReachedAlert(),c.endLoading(),c.toggleToolbarButtonsVisibility(!0),c.toggleToolbarButtons(!1),c.featureList=a,featureGridPanel.createFeatureGrid(t,a,function(){r(!0)})},function(){return c.endLoading(),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_Msg_GeneralSearch")),Utils.isNullOrUndefined(r)?void 0:(r(!1),void 0)})},this.createFeatureGrid=function(e,t,a){this.layerId=e,table=$("<table>").addClass("data-grid").css("width","100%"),this.table=table,this.gridContainer.append(table);var i=null,n=null,r=FeatureGridPanel.parseDataForGrid(t);i=r.columns,n=r.gridResult;var l=table.dataTable({serverSide:!1,scrollY:"200px",scrollX:!0,processing:!0,paginationType:"full",ajax:function(e,t){t(n)},drawCallback:function(){Utils.isNullOrUndefined(a)||a()},columns:i,language:{url:"scripts/locale/datatable/dt_"+LocaleManager.locale+".lang"}});this.dataTable=l;var o=this;this.table.find("tbody").on("click","tr",function(e){if(o.vLayer.removeAllFeatures(),$(this).hasClass("selected"))o.toggleToolbarButtons(!1),$(this).removeClass("selected");else{e.ctrlKey||o.table.find("tbody tr").removeClass("selected"),$(this).addClass("selected"),o.toggleToolbarButtons(!0);var t=Utils.getSelectedRow(o.dataTable)[0][FeatureGridPanel.FID_CONST],a=o.getFeatureByFid(t),i=[];i.push(a),o.vLayer.addFeatures(i)}}),this.table.find("tbody").on("dblclick","tr",function(){o.vLayer.removeAllFeatures(),o.table.find("tbody tr").removeClass("selected"),$(this).addClass("selected"),o.toggleToolbarButtons(!0);var e=Utils.getSelectedRow(o.dataTable)[0][FeatureGridPanel.FID_CONST],t=o.getFeatureByFid(e),a=[];a.push(t),o.vLayer.addFeatures(a),o.zoomToBtn.click()})},this.getFeatureByFid=function(e){var t=this.featureList.filter(function(t){return t.fid===e});return t[0]},this.zoomToFeat=function(e){var t=this.vLayer.getFeatureByFid(e);map.zoomToExtent(t.geometry.getBounds(),closest=!0),map.zoomOut()},this.zoomToSelected=function(){var e=Utils.getSelectedRow(this.dataTable);if(0!=e.length){var t=e[0],a=t[FeatureGridPanel.FID_CONST];this.zoomToFeat(a)}}};FeatureGridPanel.parseDataForGrid=function(e){var t={};
$.each(e,function(e,a){$.each(a.attributes,function(e){t[e]=e})});var a=[];$.each(t,function(e){var t={data:e,name:e,title:e,sortable:!0,visible:!0};a.push(t)}),a.push({data:FeatureGridPanel.FID_CONST,name:FeatureGridPanel.FID_CONST,title:FeatureGridPanel.FID_CONST,sortable:!1,visible:!1});var i={};i.data=[],$.each(e,function(e,a){var n={};$.each(t,function(e){var t=a.attributes[e];Utils.isNullOrUndefined(t)&&(t=""),n[e]=t}),n[FeatureGridPanel.FID_CONST]=a.fid,i.data.push(n)});var n={gridResult:i,columns:a};return n},FeatureGridPanel.FID_CONST="##FID##";var searchP={panel:null,button:null,menuSearchTab:null,menuTocTab:null,vLayer:null,bbox:null,init:function(){null==this.panel&&(this.panel=$("#advance-searchwfs-panel"),$("#advance-searchwfs-confirm").button({label:LocaleManager.getKey("Advanced_Panel_Search_Confirm")}).click(function(){searchP.requests.submit()}),$("#advance-searchwfs-clean").button({label:LocaleManager.getKey("General_Clean")}).click(function(){searchP.cleanForm()}),$("#search-bbox-deactive, #search-bbox-active").change(function(){searchP.bboxFilter($(this))}),$("#gis_FEAT_KEYWORD").keyup(function(e){13==e.keyCode&&searchP.requests.submit()})),null==this.button&&(this.button=$("#gis_FEAT")),null==this.menuSearchTab&&(this.menuSearchTab=$("#menu-switcher-search"),this.menuTocTab=$("#menu-switcher-toc"))},toggle:function(){this.button.hasClass("btn-active")?this.deactivateGeneral(!0):this.activate()},activate:function(){this.button.addClass("btn-active"),this.open()},deactivateGeneral:function(e){this.button.removeClass("btn-active"),this.cleanForm(),this.close(),e||Utils.isNullOrUndefined(featureGridPanel)||featureGridPanel.closePanel()},deactivate:function(){this.deactivateGeneral(!1)},open:function(){this.cleanForm(),this.panel.show()},close:function(){null!=this.panel&&this.panel.hide(),null!=searchP.vLayer&&searchP.vLayer.removeAllFeatures()},cleanForm:function(){$("#gis_FEAT_KEYWORD").val(""),$("#search_exact").prop("checked",!1),$("#search-bbox-deactive").prop("checked",!0),$("#search-bbox-active").prop("checked",!1),$("#search-bbox-selected-text").text(""),this.bboxFilter($("#search-bbox-deactive"))},bboxFilter:function(e){e.is(":checked")&&("bbox-deactive"==e.val()&&(null!=this.vLayer&&null!=controls.search.instance&&(this.vLayer.removeAllFeatures(),controls.search.deactivate(),$("#search-bbox-selected-text").text("")),$("#search-bbox-panel").hide(),$("#search-bbox-toggle-button").addClass("custom-hidden")),"bbox-active"==e.val()&&$("#search-bbox-panel").show())},setBboxSelectedText:function(){$("#search-bbox-selected-text").text(LocaleManager.getKey("Advanced_Panel_Search_SearchBboxSelectedText")),$("#search-bbox-toggle-button").removeClass("custom-hidden")},toggleVisibilityBbox:function(){null!=this.vLayer&&(this.vLayer.setVisibility(!this.vLayer.getVisibility()),this.vLayer.getVisibility()?($("#search-bbox-toggle-button i").removeClass("fa-eye-slash").addClass("fa-eye"),$("#search-bbox-toggle-button").data("locale_key","Advanced_Panel_Search_SearchBboxHideButton")):($("#search-bbox-toggle-button i").removeClass("fa-eye").addClass("fa-eye-slash"),$("#search-bbox-toggle-button").data("locale_key","Advanced_Panel_Search_SearchBboxShowButton")),LocaleManager.refreshLocalizedElement($("#search-bbox-toggle-button")))},getValuesForm:function(){var e={};return e.keyword=$("#gis_FEAT_KEYWORD").val().trim(),e.exactmatch=$("#search_exact").is(":checked"),e.bbox=null,null!=this.vLayer&&this.vLayer.features.length>0&&(e.bbox=this.vLayer.features[0].geometry.getBounds()),e},menuSearchShowAndSwitch:function(){this.menuSearchTab.show(),LayerMenu.switchTabMenu(this.menuSearchTab)},menuSearchHide:function(){LayerMenu.switchTabMenu(this.menuTocTab),this.menuSearchTab.hide()},requests:{submit:function(){var e=searchP.getValuesForm();if(Utils.isNotEmpty(e.keyword)){var t=new Search;t.searchAllVisibleLayers(e.keyword,{matchCase:!1,isExact:e.exactmatch,bboxFilter:e.bbox,crs:map.getProjection()})}else AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_SearchNoKeyword"))}},initLayer:function(){return null==this.vLayer?(this.vLayer=new OpenLayers.Layer.Vector("bboxsearch",{displayInLayerSwitcher:!1,styleMap:StyleManager.getRedlineStyle(),projection:new OpenLayers.Projection(map.getProjection()),eventListeners:{beforefeatureadded:function(e){searchP.vLayer.removeAllFeatures(),srid=e.feature.layer.projection.projCode,e.feature.geometry.transform(new OpenLayers.Projection(srid),new OpenLayers.Projection(map.getProjection()))}}}),this.vLayer.alwaysOnTop=!0,map.addLayer(this.vLayer),this.vLayer):void 0}},searchResultPanel=null,SearchResultPanel=function(){this.searchPanelMainDiv=$("#searchResultPanel");var e=this;this.clearSearchResultPanel=function(){this.searchPanelMainDiv.empty(),$("#search_result_panel_clear_all_cont").addClass("custom-hidden"),searchP.menuSearchHide()},this.buildLayerResultDiv=function(e,t){var a=null;return a=Utils.isNullOrUndefined(t)?$("<div>").attr("class","search-results-layer").append($("<div>").attr("class","search-results-layer-name").text(e),$("<div>").attr("class","search-results-tools"),$("<div>").attr("class","search-results-number-and-loading").append($("<div>").attr("class","search-results-number"),$("<div>").attr("class","search-results-loading fa fa-spinner fa-spin"))):$("<div>").attr("class","search-results-layer").append($("<div>").attr("class","search-results-layer-name").text(e),$("<div>").attr("class","search-results-error").text(t))},this.buildIconShowResults=function(t){var a=$("<div>").attr({"class":"menu-activate-layer fa-stack"}).append($("<i>").attr("class","fa fa-info fa-stack-1x"),$("<i>").attr("class","fa fa-square-o fa-stack-2x"));return a.click(function(i){i.stopPropagation(),e.isShowResultButtonDisabled($(this))||(e.disableAllShowResults(),t(a))}),a},this.addSearchNotPossibleToSearchResultPanel=function(e,t){var a=this.buildLayerResultDiv(t,LocaleManager.getKey("SearchResultPanel_Search_Not_Available"));a.data("id",e),a.data("title",t),$("#searchResultPanel").append(a),$("#search_result_panel_clear_all_cont").removeClass("custom-hidden")},this.addSearchToSearchResultPanel=function(e,t,a){var i=this.buildLayerResultDiv(t);i.data("id",e),i.data("title",t),i.data("searchParameters",a),$("#searchResultPanel").append(i),$("#search_result_panel_clear_all_cont").removeClass("custom-hidden")},this.disableAllShowResults=function(){this.searchPanelMainDiv.find(".menu-activate-layer").addClass("btn-search-results-disabled")},this.enableAllShowResults=function(){this.searchPanelMainDiv.find(".menu-activate-layer").removeClass("btn-search-results-disabled")},this.isShowResultButtonDisabled=function(e){return e.hasClass("btn-search-results-disabled")},this.addResultToSearchResultPanel=function(t,a){var i=this.findResultsNumberAndLoadingDivForResult(t);i.find(".search-results-number").text(a);var n=i.find(".search-results-loading");n.removeClass("fa fa-spinner fa-spin fa-2x"),n.addClass("custom-hidden");var r=this.findResultToolsDivForResult(t),l=this.buildIconShowResults(function(t){searchP.deactivate();var i=t.closest(".search-results-layer"),n=i.data("id"),r=i.data("searchParameters"),l=i.data("title");featureGridPanel.startLoading(n,l,r,a,function(){e.enableAllShowResults()})});r.append(l)},this.removeResultFromSearchResultPanel=function(e){var t=this.findResultLayerByDataProperty("id",e);t.remove()},this.findResultToolsDivForResult=function(e){var t=this.findResultLayerByDataProperty("id",e),a=t.find(".search-results-tools");return a},this.findResultsNumberAndLoadingDivForResult=function(e){var t=this.findResultLayerByDataProperty("id",e),a=t.find(".search-results-number-and-loading");return a},this.findResultLayerByDataProperty=function(e,t){var a=null,i=$("#searchResultPanel .search-results-layer");return $.each(i,function(i,n){var r=$(n).data(e);return t===r?(a=$(n),!1):!0}),a},this.addSearchResultsToSearchResultPanelOLD=function(e,t){this.vLayer.addFeatures(t);for(var a=$("<div>").attr("class","seacrh-results-layer").append($("<div>").attr("class","seacrh-results-layer-name").text(e)),i=0;t.length>i;i++){var n=t[i],r=buildFeatureInfoDiv(n);r.data("fid",n.fid);var l=this._callbacks.onclick;r.click(function(){var e=$(this).data("fid");Utils.isNullOrUndefined(l)||l(e)}),a.append(r)}$("#searchResultPanel").append(a)}},SearchFilterHelper=function(e){this._layerAttributesList=e,this.ALLOWED_FILTER_TYPES=["int","string","decimal"],this._isTypeFilterable=function(e){var t=Utils.isInArrayAsBool(e,this.ALLOWED_FILTER_TYPES);return t?!0:!1},this._getFilterableAttributeList=function(){for(var e=[],t=0;this._layerAttributesList.length>t;t++){var a=this._layerAttributesList[t];this._isTypeFilterable(a.type)&&e.push(a)}return e},this._isCompareConditionCompatibleWithType=function(e,t){return"int"!==t||Utils.isInt(e)?"decimal"!==t||Utils.isFloat(e)?!0:!1:!1},this.createFilterOL=function(e,t,a,i,n){for(var r=null,l=this._getFilterableAttributeList(),o=0,s=0;l.length>s;s++){var c=l[s],u=this._isCompareConditionCompatibleWithType(e,c.type);u&&(r=0==o?this.createCompareCondition(e,c.name,c.type,t,a):this.addOrCondition(e,c.name,c.type,r,t,a),o++)}if(!Utils.isNullOrUndefined(i)){var d=null,g=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:i,projection:n});g&&(d=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[r,g]})),r=d}return r},this.getCompareOperatorForType=function(e){var t=null;return"int"===e?t=OpenLayers.Filter.Comparison.EQUAL_TO:"string"===e?t=OpenLayers.Filter.Comparison.LIKE:"decimal"===e&&(t=OpenLayers.Filter.Comparison.EQUAL_TO),t},this.createCompareCondition=function(e,t,a,i,n){var r=this.getCompareOperatorForType(a);r===OpenLayers.Filter.Comparison.LIKE&&n&&(e="*"+e+"*");var l=new OpenLayers.Filter.Comparison({type:r,property:t,value:e,matchCase:i});return l},this.addOrCondition=function(e,t,a,i,n,r){var l=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[i,this.createCompareCondition(e,t,a,n,r)]});return l}},Search=function(){this.searchAllVisibleLayers=function(e,t){searchResultPanel.clearSearchResultPanel();var a=t.maxFeatures,i=t.matchCase,n=t.bboxFilter,r=t.crs,l=null;l=t.isExact?!1:!0;var o=[],s=selectedLayerTree.getVisibleLayers();if(Utils.isNullOrUndefined(s))return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_SearchNoLayersSelected")),void 0;$.each(s,function(e,t){var a=$(t).data("id");o.push(a)});var c=this.searchLayer;$.each(s,function(t,o){var s=$(o).data("id"),u=catalog.getLayerConfigById(s),d=$(o).data("title"),g=null,p=null;if("wms"===u.getSource())g=u.getName(),p=u.getAttributes();else{if("wms_multi_layer"!==u.getSource())return!0;g=u.getNameByTitle(d),p=u.getAttributes(g)}var f=u.getUrl(),h={maxFeatures:a,matchCase:i,bboxFilter:n,crs:r,likeSearch:l},y={url:f,layerName:g,onlyHits:!0,layerAttributeList:p,searchTerm:e,searchOptions:h};return u.isAttributesAvailable()?(searchResultPanel.addSearchToSearchResultPanel(s,d,y),c(f,g,!0,p,e,h,function(e){searchResultPanel.addResultToSearchResultPanel(s,e)},function(){searchResultPanel.removeResultFromSearchResultPanel(s),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_Msg_GeneralSearch"))}),void 0):(searchResultPanel.addSearchNotPossibleToSearchResultPanel(s,d),void 0)}),searchP.menuSearchShowAndSwitch()},this.searchLayer=function(e,t,a,i,n,r,l,o){var s=r.maxFeatures,c=r.matchCase,u=r.bboxFilter,d=r.crs,g=r.likeSearch,p=new SearchFilterHelper(i),f=p.createFilterOL(n,c,g,u,d),h="results";a===!0&&(h="hits"),doGetFeaturesPOST(e,{typeNames:t,filterOL:f,maxFeatures:s,resultType:h},l,o)}},addWmsDialog=null,AddWMSDialog=function(){var e=this;this.wmsDialogOpen=!1,this.wmsDialog=null,this.wmsListLoaded=!1,this.wmsList=null,this.lp=null,this.grid=null,this.outerGridContainer=null,this.toggle=function(e){e.hasClass("btn-active")?this.deactivate(e):this.showWMSDialog()},this.fetchWmsList=function(t){$.ajax({url:"./systemConfig",type:"GET",dataType:"json",cache:!1,data:{oper:"exportExternalWmsServersAsJson"}}).done(function(a){e.wmsList=a.wms_list,e.wmsListLoaded=!0,Utils.isNullOrUndefined(t)||t(a.wms_list)}).fail(function(){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_Msg_GetCapabilities_fail"))})},this._addToWmsList=function(e){var t={url:e,name:e};this.wmsList.push(t)},this.populateWmsListAndLoadCapabilities=function(t){$.each(t,function(t,a){var i=a.url,n=a.name;e._appendToWMSSelectBox(i,n)});var a=$("#wmsList").find(":selected");a.text();var i=a.attr("name"),n=this.outerGridContainer.find(".flexigrid");e.lp=new LoadingPanel(n,LocaleManager.getKey("Loading"),!1),e.lp.addLoading(),e.loadCapabilitiesIntoGrid(i,this.grid,function(){e.lp.removeLoading()})},this._appendToWMSSelectBox=function(e,t){var a=$("#wmsList"),i=$("<option>",{name:e}).html(t);a.append(i)},this._refreshCapabilitiesForSelectedWMS=function(e){var t=$("#wmsList").find(":selected");t.data({capabilities:e})},this._getSelectedWMSFromDropdownList=function(){var e=$("#wmsList").find(":selected"),t=e.text(),a=e.attr("name"),i={url:a,name:t,capabilities:e.data("capabilities")};return i},this._getSelectedRowFromGRID=function(e){var t=null;return $(".trSelected",e).each(function(e,a){t=a}),t},this.wmsDialogCloseCallbackFn=function(){e.wmsDialogOpen=!1,e.wmsDialog=null,$("#gis_WMSDialog").removeClass("btn-active")},this.deactivate=function(){this.wmsDialog.dialog("close")},this.showWMSDialog=function(){if(this.wmsDialogOpen===!0)return alert("already open"),void 0;$("#gis_WMSDialog").addClass("btn-active"),this.outerGridContainer=$("<div>",{id:"wms_grid_container"}),this.grid=$("<div>");var t=this.grid;this.outerGridContainer.append(this.grid);var a=$("<select id='wmsList'>").change(function(){var a=e.outerGridContainer.find(".flexigrid");e.lp=new LoadingPanel(a,LocaleManager.getKey("Loading"),!1),e.lp.addLoading();var i=$(this).find(":selected");i.text();var n=i.attr("name");e.loadCapabilitiesIntoGrid(n,t,function(){e.lp.removeLoading()})}),i=$("<button>",{id:"wms_addWMS"}).text(LocaleManager.getKey("WMS_Add_New")).button().click(function(){var t=null,a=function(a){doGetCapabilities(a,function(i){e._appendToWMSSelectBox(a,a),e._refreshCapabilitiesForSelectedWMS(i),e._addToWmsList(a),t.dialog("close")},function(){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Title"),LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Text"))})};t=displayAddWMSDialog(a),t.dialog("open")}),n=$("<div>").append($("<div>").attr("style","padding:5px;").append(LocaleManager.getKey("WMSDialog_SelectWMS_Label"),a,i),this.outerGridContainer),r={};r[LocaleManager.getKey("WMSDialog_Button_AddLayer")]=function(){e.addLayerClicked(t)},r[LocaleManager.getKey("WMSDialog_Button_Done")]=function(){l.dialog("close")};var l=DialogUtils.createDialog(LocaleManager.getKey("WMSDialog_Title"),r,{width:700,height:350,resizable:!1,modal:!0,closeFn:function(){e.wmsDialogCloseCallbackFn()}},n);t.flexigrid({colModel:[{display:LocaleManager.getKey("WMSDialog_Grid_Title"),name:"title",width:430,sortable:!0,align:"left"},{display:LocaleManager.getKey("WMSDialog_Grid_Id"),name:"id",width:200,sortable:!0,align:"left"}],dataType:"json",singleSelect:!0,height:178,id:"pippo"}),t.dblclick(function(){e.addLayerClicked($(this))}),l.dialog("open"),this.wmsDialogOpen=!0,this.wmsListLoaded?this.populateWmsListAndLoadCapabilities(this.wmsList):this.fetchWmsList(function(t){e.populateWmsListAndLoadCapabilities(t)}),e.wmsDialog=l},this.addLayerClicked=function(e){var t=this._getSelectedRowFromGRID(e);if(!Utils.isNullOrUndefined(t)){var a=$('td[abbr="title"] >div',t).html(),i=$('td[abbr="id"] >div',t).html(),n=this._getSelectedWMSFromDropdownList(),r=n.url,l=LayerMenu.getLayerLIFromMenu(r,i);if(Utils.isNullOrUndefined(l)){var o=n.capabilities,s=checkIfSrsSupported(map.getProjection(),i,o);if(s)this.addLayerWMSToCatalogAndWebGIS(n.url,i,a,o);else{var c=LocaleManager.getKey("GetCapabilities_SRS_Not_Supported_Error_Dialog_Title"),u=LocaleManager.getKey("GetCapabilities_SRS_Not_Supported_Error_Dialog_Text");AlertDialog.createOkDefaultDialog(c,u)}}else LayerMenu.selectAndOpenLayerInMenu(l)}},this.addLayerWMSToCatalogAndWebGIS=function(e,t,a,i){var n=i.capability.layers,r=null;$.each(n,function(e,a){var i=a.name;if(i===t){var n=new OpenLayers.Projection("EPSG:4326"),l=new OpenLayers.Projection(map.getProjection()),o=a.llbbox[0],s=a.llbbox[1],c=a.llbbox[2],u=a.llbbox[3],d=new OpenLayers.Bounds(o,s,c,u);r=d.transform(n,l)}});var l={source:"wms",title:a,url:e,name:t,enabled:!0,capabilities:i,bounds:r,wmsOptions:{format:"image/png",transparent:!0},olOptions:{buffer:0,displayOutsideMaxExtent:!0,isBaseLayer:!1,singleTile:!1},group:"layers"},o=new LayerConfig(l);catalog.addLayerToConfig(o),LoadLayersUtils.loadStdLayerInSelectedLayerTreeFromOutside(o,function(){var e=o.getBounds();Utils.isNullOrUndefined(e)||zoomToExtent(e,!0)})},this.loadCapabilitiesIntoGrid=function(t,a,i){doGetCapabilities(t,function(t){e._refreshCapabilitiesForSelectedWMS(t);var n=[];if(Utils.isNullOrUndefined(t.capability))alert("error");else{var r=t.capability.layers;$.each(r,function(e,t){var a=t.title,i=t.name,r={cell:[a,i]};n.push(r)});var l={total:n.length,page:1,rows:n};a.flexAddData(l)}a.flexReload(),Utils.isNullOrUndefined(i)||i()},function(){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Title"),LocaleManager.getKey("GetCapabilities_Server_Connection_Error_Dialog_Text")),Utils.isNullOrUndefined(i)||i()})}};addWmsDialog=new AddWMSDialog,LegendGraphics.getLegendImageLayer=function(e,t){var a=LegendGraphics.createGetLegendGraphicUrl(e,t),i=$("<img>").attr("src",a),n=$("<div>",{"class":"legendItem custom-hidden"}).append(i);return n},LegendGraphics.createGetLegendGraphicUrl=function(e,t){var a={service:"WMS",request:"GetLegendGraphic",format:"image/png",transparent:!0,width:20,height:20,layer:t,SCALE:2183910.7257279875,LEGEND_OPTIONS:"forceLabels:on;fontSize:10"},i="",n=0;$.each(a,function(e,t){n>0&&(i+="&"),i+=e+"="+encodeURIComponent(t),n++});var r=e+"?"+i;return r};var controls={WMSGetFeatureInfo:{isControl:!0,isToggle:!0,instance:null,button:null,buttonId:"gis_getFeatureInfoBtn",init:function(e){this.button=$("#"+this.buttonId),this.instance=new OpenLayers.Control.WMSGetFeatureInfo({title:"Identify features by clicking",drillDown:!0,layers:e,queryVisible:!0,infoFormat:"application/vnd.ogc.gml",format:new OpenLayers.Format.GML.v2,eventListeners:{getfeatureinfo:function(e){featureInfoResults.showWMSGetFeatureInfoDialog(e)}}}),map.addControl(this.instance)},activate:function(e){controls.deactivate(),this.init(e),this.instance.activate(),controls.buttons.activate(this.button)},deactivate:function(){controls.buttons.deactivate(this.button),null!=this.instance&&(this.instance.deactivate(),map.removeControl(this.instance),this.instance.destroy(),this.instance=null)}},KMLFeatureInfo:{isControl:!0,isToggle:!0,instance:null,button:null,buttonId:"gis_getFeatureInfoBtn",unselectAll:function(){null!=this.instance&&this.instance.unselectAll()},init:function(e){this.button=$("#"+this.buttonId),this.instance=new OpenLayers.Control.SelectFeature(e,{clickout:!0,toggle:!0,multiple:!1,hover:!1,box:!1}),this.instance.events.register("featurehighlighted",this.instance,function(e){featureInfoResults.showKMLGetFeatureInfoDialog(e)}),map.addControl(this.instance)},activate:function(e){controls.deactivate(),this.init(e),this.instance.activate(),controls.buttons.activate(this.button)},deactivate:function(){controls.buttons.deactivate(this.button),null!=this.instance&&(this.instance.deactivate(),map.removeControl(this.instance),this.instance.destroy(),this.instance=null)}},redlines:{isControl:!0,isToggle:!0,instance:null,init:function(){return this.instance={pointDraw:new OpenLayers.Control.DrawFeature(redlines.vLayer,OpenLayers.Handler.Point),lineDraw:new OpenLayers.Control.DrawFeature(redlines.vLayer,OpenLayers.Handler.Path),polygonDraw:new OpenLayers.Control.DrawFeature(redlines.vLayer,OpenLayers.Handler.Polygon),select:new OpenLayers.Control.SelectFeature(redlines.vLayer,{clickout:!0,toggle:!0,multiple:!0,hover:!1,box:!0}),modify:new OpenLayers.Control.ModifyFeature(redlines.vLayer)},this.instance.modify.mode=OpenLayers.Control.ModifyFeature.RESHAPE|OpenLayers.Control.ModifyFeature.DRAG,this.addControlsToMap(),this.addEventCtrls(),this.instance},addEventCtrls:function(){$.each(this.instance,function(e,t){("pointDraw"==e||"lineDraw"==e||"polygonDraw"==e)&&t.events.register("featureadded",t,function(){}),"select"==e&&(t.events.register("featurehighlighted",t,function(){redlines.vLayer.selectedFeatures.length>1?(redlines.toggleButtons("delete","enable"),redlines.toggleButtons("label","disable")):1==redlines.vLayer.selectedFeatures.length?(redlines.toggleButtons("delete","enable"),redlines.toggleButtons("label","enable")):(redlines.toggleButtons("delete","disable"),redlines.toggleButtons("label","disable"))}),t.events.register("featureunhighlighted",t,function(){var e=Utils.getSelectedFeatures(redlines.vLayer.selectedFeatures);e>1?redlines.toggleButtons("delete","enable"):1==e?(redlines.toggleButtons("delete","enable"),redlines.toggleButtons("label","enable")):(redlines.toggleButtons("delete","disable"),redlines.toggleButtons("label","disable"))}))}),redlines.vLayer.events.on({beforefeaturemodified:function(){redlines.buttons.label.toggle("enable")},afterfeaturemodified:function(){redlines.buttons.label.toggle("disable")}})},addControlsToMap:function(){null!=this.instance&&$.each(this.instance,function(e,t){map.addControl(t)})},activate:function(e){var t=e.data("action");Utils.removeLabelInput(),null==this.instance&&this.init(),controls.deactivate(),controls.buttons.activate(e),this.instance[t].activate()},deactivate:function(e){if(e){var t=e.data("action");return this.instance[t].deactivate(),controls.buttons.deactivate(e),redlines.toggleButtons("delete","disable"),redlines.toggleButtons("label","disable"),this.instance.select.unselectAll(),void 0}controls.buttons.deactivate(),null!=this.instance&&($.each(this.instance,function(e,t){t.deactivate()}),this.instance.select.unselectAll()),redlines.toggleButtons("delete","disable"),redlines.toggleButtons("label","disable")}},alerts:{isControl:!0,isToggle:!0,instance:null,init:function(){return this.instance={pointDraw:new OpenLayers.Control.DrawFeature(alerts.vLayerEdit,OpenLayers.Handler.Point),lineDraw:new OpenLayers.Control.DrawFeature(alerts.vLayerEdit,OpenLayers.Handler.Path),polygonDraw:new OpenLayers.Control.DrawFeature(alerts.vLayerEdit,OpenLayers.Handler.Polygon),select:new OpenLayers.Control.SelectFeature(alerts.vLayerEdit,{clickout:!1,toggle:!1,multiple:!1,hover:!1,box:!1}),selectmap:new OpenLayers.Control.SelectFeature(alerts.vLayer,{clickout:!0,toggle:!0,multiple:!1,hover:!1,box:!1}),modify:new OpenLayers.Control.ModifyFeature(alerts.vLayerEdit)},this.instance.modify.mode=OpenLayers.Control.ModifyFeature.RESHAPE|OpenLayers.Control.ModifyFeature.DRAG,this.addControlsToMap(),this.addEventCtrls(),this.instance},addEventCtrls:function(){alerts.vLayerEdit.events.on({beforefeatureadded:function(){alerts.vLayerEdit.removeAllFeatures()}}),this.instance.selectmap.events.register("featurehighlighted",this,function(e){e.feature})},addControlsToMap:function(){null!=this.instance&&$.each(this.instance,function(e,t){map.addControl(t)})},activate:function(e){controls.deactivate(),e&&(action=e.data("action"),controls.buttons.activate(e)),null==this.instance&&this.init(),this.instance[action].activate()},deactivate:function(e){if(e){var t=e.data("action");return this.instance[t].deactivate(),controls.buttons.deactivate(e),this.instance.selectmap.unselectAll(),void 0}controls.buttons.deactivate(),null!=this.instance&&($.each(this.instance,function(e,t){t.deactivate()}),$("#alerts-update-modgeom").removeClass("btn-active"),alerts.changeGeomActive||$("#alerts-update-modgeomtype").removeClass("btn-active"),this.instance.selectmap.unselectAll())}},catalog:{isControl:!0,isToggle:!0,instance:null,init:function(){null==catalogCsw.vLayer&&catalogCsw.initLayer(),this.instance=new OpenLayers.Control.DrawFeature(catalogCsw.vLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,angle:0,snapAngle:90,irregular:!0,fixedRadius:!0}}),map.addControl(this.instance),this.instance.events.register("featureadded",this.instance,function(){catalogCsw.setBboxSelectedText(),controls.catalog.deactivate()})},activate:function(){null==this.instance&&this.init(),controls.deactivate(),catalogCsw.vLayer.removeAllFeatures(),this.instance.activate()},deactivate:function(){null!=this.instance&&this.instance.deactivate()}},search:{isControl:!0,isToggle:!0,instance:null,options:{sides:4,angle:0,snapAngle:90,irregular:!0,fixedRadius:!0},init:function(){return null==searchP.vLayer&&searchP.initLayer(),this.instance=new OpenLayers.Control.DrawFeature(searchP.vLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:this.options}),map.addControl(this.instance),this.instance.events.register("featureadded",this.instance,function(){searchP.setBboxSelectedText(),controls.search.deactivate()}),this.instance},activate:function(){null==this.instance&&this.init(),controls.deactivate(),searchP.vLayer.removeAllFeatures(),this.instance.activate()},deactivate:function(){null!=this.instance&&this.instance.deactivate()}},print:{isControl:!0,isToggle:!0,instance:!0,deactivate:function(){print.active&&print.deactivate(print.button)}},measure:{isControl:!0,isToggle:!0,instance:null,panelViewId:"gis_measures",init:function(){this.panelView=$("#"+this.panelViewId),this.instance={line:{buttonId:"gis_measureLineBtn",init:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,handlerOptions:{layerOptions:{styleMap:styleMapMeasureControls}}})},polygon:{buttonId:"gis_measureAreaBtn",init:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,handlerOptions:{layerOptions:{styleMap:styleMapMeasureControls}}})}},$.each(this.instance,function(e,t){t.button=$("#"+t.buttonId),t.init.events.on({measure:handleMeasurements,measurepartial:handleMeasurements}),map.addControl(t.init)})},activate:function(e){controls.deactivate(),null==this.instance&&this.init(),e&&(controls.buttons.activate(this.instance[e].button),this.instance[e].init.activate()),this.panelView&&(this.panelView.empty().text(LocaleManager.getKey("Measure_Panel_Measure_Text")),this.panelView.show())},deactivate:function(e){null!=this.instance&&(e&&(controls.buttons.deactivate(this.instance[e].button),this.instance[e].init.deactivate()),$.each(this.instance,function(e,t){controls.buttons.deactivate(t.button),t.init.deactivate()})),this.panelView&&this.panelView.hide()}},deactivate:function(e){return e?(e.deactivate(),void 0):($.each(this,function(e,t){t.isControl&&t.isToggle&&null!=t.instance&&t.deactivate()}),void 0)},buttons:{deactivate:function(e){e?e.removeClass("btn-active"):$(".ctrlButtons").removeClass("btn-active")},activate:function(e){this.deactivate(),e&&e.addClass("btn-active")}}};AdvancedPanel.toggleAdvancedTools=function(e){var t=e.data("tool");switch("print"!=t&&controls.deactivate(),"uploadkml"!=t&&kmlupload.deactivate(),"redlines"!=t&&redlines.closePanel(),"comments"!=t&&comments.deactivate(),"searchwfs"!=t&&searchP.deactivate(),"alerts"!=t&&("print"===t?alerts.closePanelGeneralForPrint():alerts.closePanelGeneral()),"print"!=t&&print.deactivate(),"coordinates"!=t&&coordinates.deactivate(),"catalogcsw"!=t&&catalogCsw.deactivate(),t){case"redlines":redlines.toggle(e);break;case"comments":comments.toggle(e);break;case"alerts":alerts.toggle(e);break;case"searchwfs":searchP.toggle(e);break;case"print":print.toggle(e);break;case"coordinates":coordinates.toggle(e);break;case"uploadkml":kmlupload.toggle();break;case"catalogcsw":catalogCsw.toggle(e)}},MenuButtons.featureInfoComponentClicked=function(){var e=$("#gis_getFeatureInfoBtn").hasClass("btn-active");if(e)return controls.WMSGetFeatureInfo.deactivate(),controls.KMLFeatureInfo.deactivate(),void 0;var t=selectedLayerTree.getSelectedLayer();if(Utils.isNullOrUndefined(t))return controls.WMSGetFeatureInfo.deactivate(),controls.KMLFeatureInfo.deactivate(),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_LayerNoSelected")),void 0;var a=t.data("id"),i=catalog.getLayerConfigById(a);if("wms"==i.getSource()){var n=[],r=!1;if(r){var l=selectedLayerTree.getVisibleLayers();$.each(l,function(e,t){var a=$(t).data("layerOL");n.push(a)})}else{var o=t.data("layerOL");n.push(o)}controls.WMSGetFeatureInfo.activate(n)}else{if("kml"!=i.getSource())return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_LayerWmsNoSelected")),void 0;var s=t.data("layerOL");controls.KMLFeatureInfo.activate(s)}},MenuButtons.downloadButtonClicked=function(){var e=selectedLayerTree.getSelectedLayer();if(Utils.isNullOrUndefined(e))return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_LayerNoSelected")),void 0;var t=e.data("id"),a=catalog.getLayerConfigById(t);if("wms"!==a.getSource()&&"wms_multi_layer"!==a.getSource())return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_LayerWmsNoSelected")),void 0;if(a.isWFSGetFeatureAvailable()!==!0)return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("Download_Layer_Not_Available")),void 0;var i=a.getUrl(),n=a.getName();AlertDialog.createConfirmDefaultDialog(LocaleManager.getKey("Base_Panel_Download"),LocaleManager.getKey("Base_Panel_Download_Confirm")+" "+a.getTitle(),function(){(new DataDownloader).downloadZip(i,n)})};var redlines={vLayer:null,panel:null,init:function(){null==this.panel&&(this.panel=$("#advance-redlines-panel")),null==this.vLayer?(this.initLayer(),this.requests.getData(!1)):(redlines.openPanel(),this.vLayer.setVisibility(!0))},toggle:function(e){e.hasClass("btn-active")?null!=this.panel&&(this.panel.is(":visible")?this.deactivate(e):this.openPanel()):this.activate(e)},activate:function(e){e.addClass("btn-active"),this.init()},deactivate:function(e){e.removeClass("btn-active"),this.closePanel(),this.cleanControls()},remove:function(e){null!=this.vLayer&&(e?this.vLayer.removeAllFeatures():this.vLayer.setVisibility(!1))},selectFeature:function(e){return e.hasClass("btn-active")?(controls.redlines.deactivate(e),!1):(controls.redlines.activate(e),void 0)},modifyFeature:function(e){return e.hasClass("btn-active")?(controls.redlines.deactivate(e),!1):(redlines.vLayer.selectedFeatures.length>0?(controls.redlines.activate(e),$.each(redlines.vLayer.selectedFeatures,function(e,t){controls.redlines.instance.modify.selectFeature(t)})):controls.redlines.activate(e),void 0)},toggleButtons:function(e,t){"delete"==e&&this.buttons.remove.toggle(t),"label"==e&&this.buttons.label.toggle(t)},deleteFeature:function(e){if(e.hasClass("btn-disable"))return!1;if(redlines.vLayer.selectedFeatures.length>0){var t=[];$.each(redlines.vLayer.selectedFeatures,function(e,a){t.push(a)}),this.vLayer.removeFeatures(t),this.toggleButtons("disable")}else AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("AlertDialog_Warning_Edit_FeatureNotSelected"))},addLabel:function(){if(redlines.vLayer.selectedFeatures.length>0){var e=redlines.vLayer.selectedFeatures[0],t=e.geometry.getCentroid(),a=Utils.getPixelFromMapCoords(t);$("#input-label-panel").css({top:a.y+15,left:a.x+15}).show()}},saveLabel:function(){var e=$("#input-label").val();Utils.removeLabelInput();
var t=Utils.formatStringWithLineBreaks(10,e);if(redlines.vLayer.selectedFeatures.length>0){var a=redlines.vLayer.selectedFeatures[0];$.each(redlines.vLayer.features,function(e,i){return a.id==i.id?(i.attributes.label=t,i.attributes.show="yes",redlines.vLayer.redraw(),controls.redlines.instance.select.unselectAll(),!1):void 0})}},initLayer:function(){return null==this.vLayer?(this.vLayer=new OpenLayers.Layer.Vector("redlines",{displayInLayerSwitcher:!1,styleMap:StyleManager.getRedlineStyle(),projection:new OpenLayers.Projection(map.getProjection()),eventListeners:{beforefeatureadded:function(e){srid=e.feature.attributes.hasOwnProperty("epsg")?e.feature.attributes.epsg:e.feature.layer.projection.projCode,e.feature.geometry.transform(new OpenLayers.Projection(srid),new OpenLayers.Projection(map.getProjection()))}}}),this.vLayer.alwaysOnTop=!0,map.addLayer(this.vLayer),this.vLayer):void 0},zoomToLayer:function(){null!=this.vLayer&&map.zoomToExtent(this.vLayer.getDataExtent())},reloadData:function(e){this.remove(!0),this.requests.getData(e)},requests:{getData:function(e){Utils.ajaxCall("./redlining","GET","json",{oper:"get",type:"r"},function(t){if(t.success){if(t.result.length>0){var a=Utils.getFeaturesFromList(t.result,null,["epsg","label","show"]);a.length>0&&(redlines.vLayer.addFeatures(a),e&&map.zoomToExtent(redlines.vLayer.getDataExtent()))}}else AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),t.msg);redlines.openPanel()})},save:function(e){Utils.ajaxCall("./redlining","POST","json",{oper:"save",type:"r",list:JSON.stringify(e)},function(e){e.success?redlines.reloadData(!1):AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),e.msg)})}},openPanel:function(){return $("#redline-typegeoms div").removeClass("active"),null==controls.redlines.instance?controls.redlines.init():controls.redlines.deactivate(),this.panel.show(),!0},closePanel:function(){null!=this.panel&&this.panel.hide(),Utils.removeLabelInput(),$("#redline-typegeoms div").removeClass("selected"),controls.redlines.deactivate()},cleanControls:function(){$("#redline-typegeoms div").removeClass("selected"),this.remove(),controls.redlines.deactivate()},selectGeomType:function(e){return e.hasClass("btn-active")?(controls.redlines.deactivate(e),!1):(controls.redlines.activate(e),void 0)},saveGeoms:function(){controls.redlines.deactivate();var e=[];if(null!=this.vLayer){var t=this.vLayer.features;$.each(t,function(t,a){var i={},n=a.geometry.clone();i.geometryType=Utils.getGeomType(a.geometry.CLASS_NAME.split(".")[2]),i.wktGeometry=Utils.getGeomWKT(n.transform(new OpenLayers.Projection(a.layer.projection.projCode),new OpenLayers.Projection(Utils.getDefaultDbEPSG()))),a.attributes.hasOwnProperty("label")&&""!=a.attributes.label&&(i.label=Utils.getFeatureLabel(a)),e.push(i)})}redlines.requests.save(e)},buttons:{remove:{toggle:function(e){switch(e){case"enable":$("#redline-ctrl-delete").removeClass("btn-disable");break;case"disable":$("#redline-ctrl-delete").addClass("btn-disable")}}},label:{toggle:function(e){switch(e){case"enable":$("#redline-ctrl-label").removeClass("btn-disable");break;case"disable":$("#redline-ctrl-label").addClass("btn-disable"),Utils.removeLabelInput()}}}}},comments={vLayer:null,panel:null,init:function(){null==this.panel&&(this.panel=$("#advance-comments-panel"),this.button=$("#gis_commentsBtn"),this.inputText=$("#comments-input"),$("#comments-text-submit").button()),this.requests.getComment(),this.openPanel()},toggle:function(e){e.hasClass("btn-active")?this.deactivate(e):this.activate(e)},activate:function(e){e.addClass("btn-active"),this.init(),this.active=!0},deactivate:function(e){e||(e=$("#gis_commentsBtn")),e.removeClass("btn-active"),this.closePanel(),this.active=!1},closePanel:function(){null!=this.panel&&this.panel.hide()},openPanel:function(){null!=this.panel&&this.panel.show()},saveData:function(){var e=this.inputText.val();this.requests.saveComment(e)},requests:{saveComment:function(e){Utils.ajaxCall(Services.getCommentsUrl(),"POST","json",{oper:"saveComment",commentText:e},function(e){e.success&&(comments.requests.getComment(),AlertDialog.createOkDefaultDialog(LocaleManager.getKey("Advanced_Panel_Comments"),LocaleManager.getKey("General_Save_Ok")))})},getComment:function(){Utils.ajaxCall(Services.getCommentsUrl(),"POST","json",{oper:"getComment"},function(e){e.success&&e.hasOwnProperty("result")&&comments.inputText.val(e.result.text)})}}},AlertDownloadFilterHelper=function(){this.createDateFilterOL=function(e,t,a){var i=null,n=0;if(Utils.isNullOrUndefined(e)||(i=this.createGreaterThanDateCondition(e,a),n++),!Utils.isNullOrUndefined(t)){var r=this.createLessThanDateCondition(t,a);i=0==n?r:this.addAndCondition(i,r),n++}return i},this.createGreaterThanDateCondition=function(e,t){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:t,value:e});return a},this.createLessThanDateCondition=function(e,t){var a=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:t,value:e});return a},this.addAndCondition=function(e,t){var a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[e,t]});return a}},alerts={vLayer:null,vLayerEdit:null,fullPanel:null,fullPanelDialogDiv:null,fullPanelValidator:null,fullPanelGridContainer:null,fullPanelInsertContainer:null,fullPanelUpdateContainer:null,fullPanelDownloadContainer:null,statusDialogDiv:null,grid:null,dataT:null,pager:"#alerts-pager-grid",modifyGeomActive:!1,changeGeomActive:!1,currentForm:null,simplePanel:null,simpleInsertPanel:null,detailPanel:null,formInsert:null,validatorFormInsert:null,formUpdate:null,validatorFormUpdate:null,formDownload:null,alertReferenceLayer:null,panelSizes:{fullPanelModify:{width:450,height:400},fullPanelInsert:{width:450,height:400},fullPanelDownload:{width:450,height:180},fullPanelViewGrid:{width:1e3,height:420}},canOpenFullPanel:function(){var e=!1;return Utils.isNullOrUndefined(userPermissions)||(e=userPermissions.hasPermission("ALERTS_READ")),e},simplePanelSwitchMenu:function(e){$(".simple-advance-alerts-panel-link").removeClass("simple-advance-alerts-panel-link-active"),e.addClass("simple-advance-alerts-panel-link-active");var t=e.data("tab");$(".simple-advance-alerts-panel-tab-item").addClass("custom-hidden"),$("#"+t).removeClass("custom-hidden")},toggle:function(e){e.hasClass("btn-active")?this.canOpenFullPanel()===!0?null!=this.fullPanel&&(this.fullPanel.is(":visible")?this.deactivate(e):(this.openFullPanel(),this.reloadGrid(null,!1))):null!=this.simplePanel&&(this.simplePanel.is(":visible")?this.deactivate(e):this.openSimplePanel()):this.activate(e)},activate:function(e){e.addClass("btn-active"),this.canOpenFullPanel()===!0?(this.initFullPanel(),this.openFullPanel()):(this.closeNewAlertSimple(),this.closeDetailVerifyPanel(),this.initSimplePanel(),this.openSimplePanel())},deactivate:function(e,t){e.removeClass("btn-active"),this.canOpenFullPanel()===!0?(this.closeFullPanel(),this.closeStatusPanel(),this.unselectRowsGrid()):(this.closeSimplePanel(),t!==!0&&(this.closeNewAlertSimple(),this.closeDetailVerifyPanel())),this.cleanControls()},openFullPanel:function(){this.fullPanelDialogDiv.dialog("open"),this.doAction("viewgrid")},openSimplePanel:function(){Utils.cleanForm(this.simplePanel),this.simplePanel.show()},closeFullPanel:function(){null!=this.fullPanel&&this.fullPanelDialogDiv.dialog("close")},closeDialogCallbackFn:function(){alerts.selectGeomsOnMap([]),this.closeStatusPanel(),this.unselectRowsGrid(),controls.alerts.deactivate()},closeSimplePanel:function(){null!=this.simplePanel&&this.simplePanel.hide(),this.cleanControls()},closePanelGeneral:function(e){if(this.canOpenFullPanel()===!0)this.closeFullPanel();else{var t=$("#gis_alertsBtn");this.deactivate(t,e)}},closePanelGeneralForPrint:function(){this.canOpenFullPanel()===!0?(this.closeFullPanel(),controls.alerts.deactivate()):(this.closeSimplePanel(),this.closeNewAlertSimple(),this.closeDetailVerifyPanel(!0),this.cleanControls())},addNewAlertSimple:function(){this.simpleInsertPanel.show(),this.loadReferenceLayer(),this.closePanelGeneral(!0)},loadReferenceLayer:function(){var e=catalog.getReferenceLayerForAlert();if(!Utils.isNullOrUndefined(e)){var t=e.getUrl(),a=e.getName(),i=LayerMenu.getLayerLIFromMenu(t,a);Utils.isNullOrUndefined(i)||LayerMenu.selectAndOpenLayerInMenu(i)}},closeNewAlertSimple:function(){Utils.isNullOrUndefined(this.simpleInsertPanel)||this.simpleInsertPanel.close()},closeDetailVerifyPanel:function(e){Utils.isNullOrUndefined(this.detailPanel)||this.detailPanel.close(e)},saveNewAlertSimple:function(){this.simpleInsertPanel.save()},addPointNewAlertSimple:function(){this.simpleInsertPanel.drawPoint()},verifyAlert:function(e){var t=e.val();return Utils.isNullOrUndefined(t)||Utils.isEmpty(t)?(AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Advanced_Alerts_Alert_VerifyByRefCodeInvalid")),void 0):(this.closePanelGeneral(),this.requests.getAlertByRefCodeForVerification(t),void 0)},toggleActions:function(e){var t=e.data("action");this.doAction(t)},doAction:function(e){switch(e){case"modify":null!=controls.alerts.instance&&this.deactivateSelectFeature($("#alerts-selectmap"));var t=Utils.getSelectedRow(this.dataT);if(!t)return;this.fullPanelGridContainer.hide(),this.cleanForm(this.formUpdate),this.populateUpdateForm(t[0]),this.formUpdate.show(),this.fullPanelDialogDiv.dialog("option","width",this.panelSizes.fullPanelModify.width),this.fullPanelDialogDiv.dialog("option","height",this.panelSizes.fullPanelModify.height);var a=this.vLayer.getFeaturesByAttribute("idAlert",t[0].idAlert);this.selectFeatureAlertForModify(a[0]),map.panTo(new OpenLayers.LonLat(a[0].geometry.getCentroid().x,a[0].geometry.getCentroid().y)),this.currentForm="modify";break;case"insert":null!=controls.alerts.instance&&this.deactivateSelectFeature($("#alerts-selectmap")),this.fullPanelGridContainer.hide(),this.cleanForm(this.formInsert),this.validatorFormInsert&&this.validatorFormInsert.reset(),this.formInsert.show(),this.fullPanelDialogDiv.dialog("option","width",this.panelSizes.fullPanelInsert.width),this.fullPanelDialogDiv.dialog("option","height",this.panelSizes.fullPanelInsert.height),this.currentForm="insert";break;case"download":this.fullPanelGridContainer.hide(),this.cleanForm(this.formDownload),this.formDownload.show(),this.fullPanelDialogDiv.dialog("option","width",this.panelSizes.fullPanelDownload.width),this.fullPanelDialogDiv.dialog("option","height",this.panelSizes.fullPanelDownload.height),this.currentForm="download";break;case"selectmap":this.toggleSelectFeature();break;case"viewgrid":null!=controls.alerts.instance&&this.deactivateSelectFeature($("#alerts-selectmap")),this.formInsert.hide(),this.formUpdate.hide(),this.formDownload.hide(),this.fullPanelGridContainer.show(),this.fullPanelDialogDiv.dialog("option","width",this.panelSizes.fullPanelViewGrid.width),this.fullPanelDialogDiv.dialog("option","height",this.panelSizes.fullPanelViewGrid.height),this.disableModifyControls(),this.currentForm="viewgrid";break;default:}},toggleSelectFeature:function(){var e=$("#alerts-selectmap");e.hasClass("btn-active-grid")?this.deactivateSelectFeature(e):this.activateSelectFeature(e)},activateSelectFeature:function(e){e.addClass("btn-active-grid"),controls.alerts.activate(e)},deactivateSelectFeature:function(e){e.removeClass("btn-active-grid"),controls.alerts.deactivate(e)},toggleStatusForm:function(e){e.hasClass("btn-active-grid")?(e.removeClass("btn-active-grid"),this.closeStatusPanel()):e.hasClass("btn-grid-disable")||(e.addClass("btn-active-grid"),this.openStatusPanel())},getIdsRows:function(e){var t=[];return $.each(e,function(e,a){t.push(a.idAlert)}),t},openStatusPanel:function(){var e=Utils.getSelectedRow(alerts.dataT),t=this.getIdsRows(e);$("#changestatus-alerts-id").val(t),this.statusDialogDiv.dialog("open")},closeStatusPanel:function(){this.statusDialogDiv.dialog("close")},closeStatusDialogCallbackFn:function(){this.cleanForm($("#data-grid-form-status")),$("#alerts-modify-status").removeClass("btn-active-grid")},cleanForm:function(e){e.find("input").val(""),e.find("textarea").val(""),e.find("select").val(e.find("select option:first").val())},populateUpdateForm:function(e){this.cleanForm($("#data-grid-form-update")),$("#update-alerts-name").val(e.submitterName),$("#update-alerts-email").val(e.submitterEmail),$("#update-alerts-id").val(e.idAlert),$("#update-alerts-title").val(e.title),$("#update-alerts-desc").val(e.description),$("#update-alerts-type option:selected").val(e.alertTypeId),this.validatorFormUpdate&&this.validatorFormUpdate.reset()},remove:function(e){null!=this.vLayer&&(e?this.vLayer.removeAllFeatures():this.vLayer.setVisibility(!1))},disableModifyControls:function(){controls.alerts.deactivate();var e=this.vLayer.getFeaturesByAttribute("idAlert",parseInt($("#update-alerts-id").val()));$.each(e,function(e,t){t.renderIntent="default",alerts.vLayer.drawFeature(t)}),this.vLayerEdit.removeAllFeatures()},saveData:function(e){var t=e.data("action");switch(t){case"insert":var a=this.validatorFormInsert.valid();if(!a)return;var i=this.getDataFormInsert();if(null==i||null==i.wktGeometry)return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert"),LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert_No_Feature_Added")),void 0;this.requests.save(t,i);break;case"update":var a=this.validatorFormUpdate.valid();if(!a)return;var i=this.getDataFormUpdate();if(null==i||null==i.wktGeometry)return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert"),LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert_No_Feature_Added")),void 0;this.requests.save(t,i)}},getDataFormInsert:function(){var e=alerts.vLayerEdit.features[0];if(!Utils.isNullOrUndefined(e)){var t={};return t.wktGeometry=Utils.getGeomWKT(e.geometry.transform(new OpenLayers.Projection(e.layer.projection.projCode),new OpenLayers.Projection(Utils.getDefaultDbEPSG()))),t.submitterName=$("#insert-alerts-name").val(),t.submitterEmail=$("#insert-alerts-email").val(),t.title=$("#insert-alerts-title").val(),t.description=$("#insert-alerts-desc").val(),t.alertTypeId=$("#insert-alerts-type option:selected").val(),t.geometryType=Utils.getGeomType(e.geometry.CLASS_NAME.split(".")[2]),t}},getDataFormUpdate:function(){var e=alerts.vLayerEdit.features[0];if(!Utils.isNullOrUndefined(e)){var t=e.geometry.clone(),a={};return a.wktGeometry=Utils.getGeomWKT(t.transform(new OpenLayers.Projection(e.layer.projection.projCode),new OpenLayers.Projection(Utils.getDefaultDbEPSG()))),a.submitterName=$("#update-alerts-email").val(),a.submitterEmail=$("#update-alerts-email").val(),a.title=$("#update-alerts-title").val(),a.description=$("#update-alerts-desc").val(),a.idAlert=$("#update-alerts-id").val(),a.alertTypeId=$("#update-alerts-type option:selected").val(),a.geometryType=Utils.getGeomType(e.geometry.CLASS_NAME.split(".")[2]),a}},initGrid:function(){return null!=this.fullPanel&&null==this.dataT&&(this.dataT=this.grid.dataTable({serverSide:!0,scrollY:"200px",scrollX:!0,processing:!0,paginationType:"full",ajax:function(e,t){Utils.ajaxCall("./alerts?oper=getAll","get","json",e,function(e){var a=e.result;t(a),alerts.toggleModifyButton(),alerts.toggleStatusButton()})},columns:[{data:"idAlert",name:"idAlert",title:"ID",sortable:"false",visible:!1},{data:"currentStatusCod",name:"currentStatusCod",title:"Cod. Status",sortable:!1,visible:!1},{data:"currentStatusName",name:"currentStatusName",title:LocaleManager.getKey("Advanced_Alerts_Label_Status"),sortable:!0},{data:"title",name:"title",title:LocaleManager.getKey("Advanced_Alerts_Label_Form_Title"),sortable:!0},{data:"description",name:"description",title:LocaleManager.getKey("Advanced_Alerts_Label_Form_Desc"),sortable:!0,width:"300px"},{data:"alertTypeName",name:"alertTypeName",title:LocaleManager.getKey("Advanced_Alerts_Label_Form_Type"),sortable:!0},{data:"submitterName",name:"submitterName",title:LocaleManager.getKey("Advanced_Alerts_Label_Form_Name"),sortable:!0},{data:"submitterEmail",name:"submitterEmail",title:LocaleManager.getKey("Advanced_Alerts_Label_Form_Email"),sortable:!0},{data:"referenceCode",name:"referenceCode",title:LocaleManager.getKey("Advanced_Alerts_Label_Reference_Code"),sortable:!0},{data:"insertTime",name:"insertTime",title:LocaleManager.getKey("Advanced_Alerts_Label_Insert_Time"),sortable:!0}],language:{url:"scripts/locale/datatable/dt_"+LocaleManager.locale+".lang"},order:[[8,"desc"]]}),this.grid.find("tbody").on("click","tr",function(e){$(this).hasClass("selected")?$(this).removeClass("selected"):(e.ctrlKey||alerts.grid.find("tbody tr").removeClass("selected"),$(this).addClass("selected")),alerts.toggleModifyButton(),alerts.toggleStatusButton();var t=Utils.getSelectedRow(alerts.dataT);alerts.selectGeomsOnMap(t)})),this.dataT},toggleModifyButton:function(){var e=Utils.getSelectedRow(this.dataT);1==e.length?$("#alerts-modify").removeClass("btn-grid-disable"):$("#alerts-modify").addClass("btn-grid-disable")},toggleStatusButton:function(){var e=Utils.getSelectedRow(this.dataT);e.length>0?($("#alerts-modify-status").removeClass("btn-grid-disable"),$("#alerts-zoom-selected").removeClass("btn-grid-disable")):($("#alerts-modify-status").addClass("btn-grid-disable"),$("#alerts-zoom-selected").addClass("btn-grid-disable"),this.closeStatusPanel())},reloadGeoms:function(e){this.remove(!0),this.requests.getGeoms(e)},reloadGrid:function(e,t){this.dataT.api().ajax.reload(e,t)},unselectRowsGrid:function(){null!=alerts.grid&&alerts.grid.find("tbody tr").removeClass("selected")},downloadZip:function(){var e=$("#alerts-download").data("token"),t=$("#download-alerts-datefrom").val(),a=$("#download-alerts-dateto").val();this.requests.doDownload(e,t,a)},requests:{getGeoms:function(e){Utils.ajaxCall("./alerts","POST","json",{oper:"getGeoms"},function(t){if(t.success){var a=Utils.getFeaturesFromList(t.result,null,["epsg","idAlert","currentStatusCod"]);a.length>0&&(alerts.vLayer.addFeatures(a),e&&map.zoomToExtent(alerts.vLayer.getDataExtent()))}else AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),t.msg)})},save:function(e,t){Utils.ajaxCall("./alerts","POST","json",{oper:e,data:JSON.stringify(t)},function(){alerts.reloadGeoms(!1),alerts.reloadGrid(null,!1),alerts.doAction("viewgrid")})},doDownload:function(e,t,a){var i="insert_time",n="mosef:vw_alerts_publish",r="SHAPE-ZIP",l=new AlertDownloadFilterHelper,o=l.createDateFilterOL(t,a,i),s="1.1.0",c=new OpenLayers.Format.Filter({version:s}).write(o),u=(new OpenLayers.Format.XML).write(c),d=GEOSERVER_URL+"/mosef/ows?service=WFS&version=1.0.0&request=GetFeature&typeName="+n+"&filter="+encodeURIComponent(u)+"&outputFormat="+r,g=encodeURIComponent(d),p="&user="+encodeURIComponent(e)+"&password="+encodeURIComponent(e)+"&single=true";window.location.assign(OL_PROXY_URL+g+p)},getAlertByRefCodeForVerification:function(e){Utils.ajaxCall("./alerts","POST","json",{oper:"getGeomByReferenceCode",referenceCode:e},function(e){var t=e.result;alerts.detailPanel.openAndPopulateFromData(t)},function(){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Advanced_Alerts_Alert_VerifyByRefCodeInvalid"))})}},cleanControls:function(){this.remove(),controls.alerts.deactivate()},initLayers:function(){this.vLayer=this.initLayer("alerts"),this.vLayerEdit=this.initLayer("alertsedit"),map.addLayer(this.vLayer),map.addLayer(this.vLayerEdit),StyleManager.readSLD("alerts.sld","alerts_sld",function(e){alerts.vLayer.styleMap.styles.select=StyleManager.getStyleByName(e,"alerts_selected"),alerts.vLayer.styleMap.styles.hidden=StyleManager.getStyleByName(e,"alerts_hidden"),alerts.vLayer.styleMap.styles["default"]=StyleManager.getDefaultStyle(e),alerts.vLayerEdit.styleMap.styles.select=StyleManager.getStyleByName(e,"alerts_selected"),alerts.vLayerEdit.styleMap.styles.hidden=StyleManager.getStyleByName(e,"alerts_hidden"),alerts.vLayerEdit.styleMap.styles["default"]=StyleManager.getDefaultStyle(e)})},initLayer:function(e){var t=new OpenLayers.Layer.Vector(e,{displayInLayerSwitcher:!1,styleMap:new OpenLayers.StyleMap,projection:new OpenLayers.Projection(map.getProjection()),eventListeners:{beforefeatureadded:function(e){srid=e.feature.attributes.hasOwnProperty("epsg")?e.feature.attributes.epsg:e.feature.layer.projection.projCode,e.feature.geometry.transform(new OpenLayers.Projection(srid),new OpenLayers.Projection(map.getProjection()))}}});return t.alwaysOnTop=!0,t},zoomToLayer:function(){null!=this.vLayer&&map.zoomToExtent(this.vLayer.getDataExtent())},zoomToSelected:function(){var e=Utils.getSelectedRow(alerts.dataT);if(0!=e.length){var t=e[0].idAlert,a=null;$.each(this.vLayer.features,function(e,i){return i.renderIntent="default",i.attributes.idAlert===t?(a=i,!1):void 0}),Utils.isNullOrUndefined(a)||(map.panTo(a.geometry.getBounds().getCenterLonLat()),map.zoomTo(10))}},selectGeomsOnMap:function(e){var t=[];$.each(e,function(e,a){t.push(a.idAlert)}),$.each(this.vLayer.features,function(e,a){a.renderIntent="default",Utils.isInArrayAsBool(a.attributes.idAlert,t)&&(a.renderIntent="select"),alerts.vLayer.drawFeature(a)})},selectFeatureAlertForModify:function(e){e.renderIntent="hidden",this.vLayer.drawFeature(e);var t=Utils.createCloneFeature(e);t.renderIntent="select",this.vLayerEdit.addFeatures([t]),this.vLayerEdit.drawFeature(t),Utils.setAttributesFeature(t,e.attributes)},toggleEditModifyGeom:function(e){return e.hasClass("btn-active")?(this.modifyGeomActive=!1,controls.alerts.deactivate(e),void 0):(this.modifyGeomActive=!0,this.changeGeomActive=!1,controls.alerts.activate(e),void 0)},selectGeomType:function(e){return e.hasClass("btn-active")?(controls.alerts.deactivate(e),!1):(controls.alerts.activate(e),void 0)},status:{change:function(e){for(var t=$("#changestatus-alerts-id").val(),a=t.split(","),i=0;a.length>i;i++)a[i]=+a[i];var n={};n.status=e.data("status"),n.alertIds=a,n.note=$("#alerts-status-note").val(),Utils.ajaxCall("./alerts","POST","json",{oper:"changeStatus",status:n.status,alertIds:JSON.stringify(n.alertIds),note:n.note},function(){alerts.closeStatusPanel(),alerts.reloadGrid()})}},initFullPanel:function(){if(null==this.fullPanel){this.fullPanel=$("#full-advance-alerts-panel"),this.fullPanelGridContainer=this.fullPanel.find(".data-grid-container"),this.fullPanelInsertContainer=this.fullPanel.find("#data-grid-form-insert"),this.fullPanelUpdateContainer=this.fullPanel.find("#data-grid-form-update"),this.fullPanelDownloadContainer=this.fullPanel.find("#data-grid-form-download"),this.grid=this.fullPanel.find(".data-grid");var e={closeFn:function(){alerts.closeDialogCallbackFn()},height:420,width:1e3,resizable:!1,modal:!1,extensions:!0,collapsable:!0};this.fullPanelDialogDiv=DialogUtils.renderDialog(LocaleManager.getKey("Advanced_Panel_Alerts"),{},e,this.fullPanel),this.formInsert=$("#data-grid-form-insert"),this.validatorFormInsert=new Validate({form:this.formInsert}),this.formUpdate=$("#data-grid-form-update"),this.validatorFormUpdate=new Validate({form:this.formUpdate}),this.formDownload=$("#data-grid-form-download"),Utils.ajaxCall("./generalData","POST","json",{oper:"get",object:"alertTypes"},function(e){Utils.populateCombo($("#insert-alerts-type"),e.result,"idAlertType","name"),Utils.populateCombo($("#update-alerts-type"),e.result,"idAlertType","name")})}var t={closeFn:function(){alerts.closeStatusDialogCallbackFn()},height:200,width:280,resizable:!1};this.statusDialogDiv=DialogUtils.renderDialog(LocaleManager.getKey("Advanced_Alerts_FormHeader_Status"),{},t,$("#data-grid-form-status")),$("#download-alerts-datefrom").datepicker({changeMonth:!0,onClose:function(e){$("#download-alerts-dateto").datepicker("option","minDate",e)},dateFormat:"yy-mm-dd"}),$("#download-alerts-dateto").datepicker({changeMonth:!0,onClose:function(e){$("#download-alerts-datefrom").datepicker("option","maxDate",e)},dateFormat:"yy-mm-dd"}),$("#data-grid-download-submit").button(),$("#data-grid-download-cancel").button(),null==this.vLayer&&null==this.vLayerEdit?(this.initLayers(),this.requests.getGeoms(!0)):this.vLayer.setVisibility(!0),null==this.dataT?this.initGrid():this.reloadGrid(null,!0)},initSimplePanel:function(){null==this.simplePanel&&(this.simplePanel=$("#simple-advance-alerts-panel"),this.simpleInsertPanel=new SimpleAlertInsertForm($("#alert-simple-panel-insert")),this.detailPanel=new SimpleAlertDetailForm($("#alert-simple-panel-detail")),$("#alert-insert-new-btn").button(),$("#alert-verify-btn").button()),null==this.vLayer&&null==this.vLayerEdit?this.initLayers():this.vLayer.setVisibility(!0)}},SimpleAlertInsertForm=function(){var e=this;this.formInsertDom=$("#alert-simple-panel-insert");var t={closeFn:function(){e.closeCallBackFn()},height:310,width:450,resizable:!1,modal:!1};this.dialogDiv=DialogUtils.renderDialog(LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert"),{},t,this.formInsertDom),this.formValidator=new Validate({form:this.formInsertDom}),Utils.ajaxCall("./generalData","POST","json",{oper:"get",object:"alertTypes"},function(e){Utils.populateCombo($("#simple-insert-alerts-type"),e.result,"idAlertType","name")}),this.show=function(){Utils.cleanForm(this.formInsertDom),this.formValidator&&this.formValidator.reset(),this.dialogDiv.dialog("open")},this.closeCallBackFn=function(){Utils.cleanForm(this.formInsertDom),$("#simple-insert-alerts-type").val($("#simple-insert-alerts-type option:first").val()),controls.alerts.deactivate(),alerts.vLayerEdit.removeAllFeatures()},this.close=function(){this.dialogDiv.dialog("close")},this._createDialogWithReferenceCode=function(e,t){var a=$("<p>").text(LocaleManager.getKey("Advanced_Alerts_Label_Reference_Code_Generation_Msg_1")).attr("style","font-weight: bold;"),i=$("<p>").text(LocaleManager.getKey("Advanced_Alerts_Label_Reference_Code_Generation_Msg_2")),n=$("<p>").text(LocaleManager.getKey("Advanced_Alerts_Label_Reference_Code_Generation_Msg_3")+": "+e).attr("style","font-weight: bold;"),r=$("<div>").append(a,i,n).attr("style","padding:5px;"),l={};l[LocaleManager.getKey("AlertDialog_OK")]=function(){$(this).dialog("close"),t()};var o=createDialog(LocaleManager.getKey("Advanced_Alerts_Alert_Added_Succesfully"),l,{width:400,height:200},r);return o},this.getDataForm=function(){var e=alerts.vLayerEdit.features[0];if(!Utils.isNullOrUndefined(e)){var t={};return t.wktGeometry=Utils.getGeomWKT(e.geometry.transform(new OpenLayers.Projection(e.layer.projection.projCode),new OpenLayers.Projection(Utils.getDefaultDbEPSG()))),t.submitterName=$("#simple-insert-alerts-name").val(),t.submitterEmail=$("#simple-insert-alerts-email").val(),t.title=$("#simple-insert-alerts-title").val(),t.description=$("#simple-insert-alerts-desc").val(),t.alertTypeId=$("#simple-insert-alerts-type option:selected").val(),t.geometryType=Utils.getGeomType(e.geometry.CLASS_NAME.split(".")[2]),t}},this.save=function(){var t=this.formValidator.valid();if(t){var a=this.getDataForm();return null==a||null==a.wktGeometry?(AlertDialog.createOkDefaultDialog(LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert"),LocaleManager.getKey("Advanced_Alerts_FormHeader_Insert_No_Feature_Added")),void 0):(Utils.ajaxCallSynch("./alerts","POST","json",{oper:"insert",data:JSON.stringify(a)},function(t){var a=e._createDialogWithReferenceCode(t.result.referenceCode,function(){e.close()});a.dialog("open")}),void 0)}}},SimpleAlertDetailForm=function(e){this.formDetailDom=e;var t=this,a={closeFn:function(){t.closeCallBackFn()},height:255,width:450,resizable:!1,modal:!1,extensions:!0};this.dialogDiv=DialogUtils.renderDialog(LocaleManager.getKey("Advanced_Alerts_FormHeader_Detail"),{},a,this.formDetailDom),this.show=function(){this.dialogDiv.dialog("open")},this.closeCallBackFn=function(){Utils.cleanForm(this.formDetailDom)},this.close=function(e){this.dialogDiv.dialog("close"),this.vLayer&&e!==!0&&(map.removeLayer(this.vLayer),this.vLayer=null)},this.openAndPopulateFromData=function(e){Utils.cleanForm(this.formDetailDom);var t=LocaleManager.getKey("Advanced_Alerts_FormHeader_Detail");$("#alert-simple-panel-detail-header-title").text(t+" "+e.referenceCode),$("#simple-detail-alerts-type").val(e.alertTypeName),$("#simple-detail-alerts-title").val(e.title),$("#simple-detail-alerts-desc").val(e.description),$("#simple-detail-alerts-insert-date").val(e.insertTime),$("#simple-detail-alerts-current-status").val(e.currentStatusName),this.show(),this.loadGeometry(e)},this.loadGeometry=function(e){this.vLayer?this.vLayer.removeAllFeatures():(this.vLayer=this.initLayer("alert_single"),map.addLayer(this.vLayer));var t=Utils.getFromWKT(e.wktGeometry);t.attributes.epsg="EPSG:4326";var a=[];a.push(t),this.vLayer.addFeatures(a),map.zoomToExtent(this.vLayer.getDataExtent())},this.initLayer=function(e){var t=new OpenLayers.Layer.Vector(e,{displayInLayerSwitcher:!1,styleMap:new OpenLayers.StyleMap,projection:new OpenLayers.Projection(map.getProjection()),eventListeners:{beforefeatureadded:function(e){srid=e.feature.attributes.hasOwnProperty("epsg")?e.feature.attributes.epsg:e.feature.layer.projection.projCode,e.feature.geometry.transform(new OpenLayers.Projection(srid),new OpenLayers.Projection(map.getProjection()))}}});return t.alwaysOnTop=!0,t}},sketchSymbolizers={Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}},style=new OpenLayers.Style;style.addRules([new OpenLayers.Rule({symbolizer:sketchSymbolizers})]);var styleMapMeasureControls=new OpenLayers.StyleMap({"default":style});Print_Configuration.outputFileName="print.pdf",Print_Configuration.scales=[{value:5e3,text:"1:5000"},{value:1e4,text:"1:10000"},{value:25e3,text:"1:25000"},{value:5e4,text:"1:50000"},{value:1e5,text:"1:100000"},{value:2e5,text:"1:200000"},{value:5e5,text:"1:500000"},{value:1e6,text:"1:1000000"},{value:2e6,text:"1:2000000"},{value:3e6,text:"1:3000000"},{value:4e6,text:"1:4000000"}],Print_Configuration.formats=[{value:"A4 landscape",text:"A4 landscape"},{value:"A4 portrait",text:"A4 portrait"},{value:"A3 landscape",text:"A3 landscape"},{value:"A3 portrait",text:"A3 portrait"}],Print_Configuration.dpi=[{value:190,text:"190"},{value:127,text:"127"},{value:56,text:"56"}];var print={active:!1,A4_Landscape_PrintSize:{x:260,y:145},A4_Portrait_PrintSize:{x:175,y:227},A3_Landscape_PrintSize:{x:366,y:204},A3_Portrait_PrintSize:{x:245,y:318},vLayer:null,panel:null,factors:{mm2inches:1/25.4},scales:Print_Configuration.scales,format:Print_Configuration.formats,dpi:Print_Configuration.dpi,init:function(){null==this.panel&&(this.panel=$("#advance-print-panel"),this.button=$("#gis-print"),Utils.populateCombo($("#print-layout"),this.format,"value","text"),Utils.populateCombo($("#print-scale"),this.scales,"value","text"),Utils.populateCombo($("#print-dpi"),this.dpi,"value","text"),$("#print-title").val(LocaleManager.getKey("Print_Default_Map_Title")),$("#print-scale").change(function(){print.createPointPolygon($("#print-layout option:selected").val(),$(this).find(":selected").val(),Utils.getMapCenterPoint(map)),map.zoomToScale($(this).find(":selected").val())}),$("#print-layout").change(function(){print.createPointPolygon($(this).find(":selected").val(),$("#print-scale").find(":selected").val(),Utils.getMapCenterPoint(map)),map.zoomToScale($("#print-scale").find(":selected").val())})),this.openPanel(),null==this.vLayer&&this.initLayer(),this.adjustScaleBasedOnCurrentVisibility(),this.reloadPrintBox()},onMouseMoveOnMapEventCallBackFn:function(){print.active&&print.reloadPrintBox()},adjustScaleBasedOnCurrentVisibility:function(){var e=this.getNearestMinScale();this.setNearestScale(e)},reloadPrintBox:function(){this.createPointPolygon($("#print-layout option:selected").val(),$("#print-scale option:selected").val(),Utils.getMapCenterPoint(map))
},toggle:function(e){e.hasClass("btn-active")?this.deactivate(e):this.activate(e)},activate:function(e){e.addClass("btn-active"),this.init(),this.active=!0},deactivate:function(e){(e||null!=this.button)&&(e=this.button,e.removeClass("btn-active"),this.closePanel(),this.resetPanelSettings(),this.vLayer.removeAllFeatures(),this.active=!1)},openPanel:function(){this.panel.show()},closePanel:function(){null!=this.panel&&this.panel.hide()},resetPanelSettings:function(){$.each(this.panel.find("select"),function(){$(this).val($(this).find("option:first").val())})},initLayer:function(){return null==this.vLayer?(this.vLayer=new OpenLayers.Layer.Vector("print",{displayInLayerSwitcher:!1,styleMap:StyleManager.getRedlineStyle(),projection:new OpenLayers.Projection(map.getProjection()),eventListeners:{beforefeatureadded:function(){}},print:!1}),this.vLayer.alwaysOnTop=!0,map.addLayer(this.vLayer),this.vLayer):void 0},getMap:function(){var e={tools:catalog.getToolConfig(),map:this.getMapConfig(),layers:this.getLayers()};return e},requests:{submit:function(){var e=print.getPrintOptions(),t=new MapfishPrint;t.doPrint({layout:e.layout,title:e.title,mapTitle:e.title,mapComment:e.comment,note:PRINT_SETTINGS.informationMessage,scale:e.scale,dpi:e.dpi,rotationAngle:e.rotationAngle,hasLegend:e.hasLegend})}},getPrintOptions:function(){var e={};return e.layout=$("#print-layout option:selected").val(),e.scale=$("#print-scale option:selected").val(),e.dpi=$("#print-dpi option:selected").val(),e.title=$("#print-title").val(),e.rotationAngle=$("#print-rotation_angle").val(),e.hasLegend=$("#print-include_legend").is(":checked"),e},getNearestMinScale:function(){var e=map.getScale(),t=this.getListScales(),a=t[0];return $.each(t,function(i){return t.length>i+1?e>t[i]&&t[i+1]>e?(a=t[i],!1):!0:(a=t[i],!1)}),a},getListScales:function(){var e=[];return $.each($("#print-scale option"),function(t,a){e.push($(a).val())}),e},setNearestScale:function(e){$("#print-scale").val(e)},createPointPolygon:function(e,t,a){this.vLayer.removeAllFeatures();var i=this.getCoordsInInches(a,e),n=this.getPointsInUnitMap(i),r=new OpenLayers.Geometry.LinearRing(n),l=new OpenLayers.Geometry.Polygon([r]),o=new OpenLayers.Feature.Vector(l);o.geometry.resize(t,a),this.vLayer.addFeatures([o])},getCoordsInInches:function(e,t){var a={x:OpenLayers.INCHES_PER_UNIT[map.getUnits()]*e.x,y:OpenLayers.INCHES_PER_UNIT[map.getUnits()]*e.y},i=null;switch(t){case"A4 landscape":i={h:this.A4_Landscape_PrintSize.y*parseFloat(this.factors.mm2inches),w:this.A4_Landscape_PrintSize.x*parseFloat(this.factors.mm2inches)};break;case"A4 portrait":i={w:this.A4_Portrait_PrintSize.x*parseFloat(this.factors.mm2inches),h:this.A4_Portrait_PrintSize.y*parseFloat(this.factors.mm2inches)};break;case"A3 landscape":i={h:this.A3_Landscape_PrintSize.y*parseFloat(this.factors.mm2inches),w:this.A3_Landscape_PrintSize.x*parseFloat(this.factors.mm2inches)};break;case"A3 portrait":i={w:this.A3_Portrait_PrintSize.x*parseFloat(this.factors.mm2inches),h:this.A3_Portrait_PrintSize.y*parseFloat(this.factors.mm2inches)}}var n={xMin:a.x-i.w/2,yMin:a.y-i.h/2,xMax:a.x+i.w/2,yMax:a.y+i.h/2};return n},getPointsInUnitMap:function(e){var t=e.xMin/OpenLayers.INCHES_PER_UNIT[map.getUnits()],a=e.yMin/OpenLayers.INCHES_PER_UNIT[map.getUnits()],i=e.xMax/OpenLayers.INCHES_PER_UNIT[map.getUnits()],n=e.yMax/OpenLayers.INCHES_PER_UNIT[map.getUnits()],r=[new OpenLayers.Geometry.Point(t,a),new OpenLayers.Geometry.Point(t,n),new OpenLayers.Geometry.Point(i,n),new OpenLayers.Geometry.Point(i,a)];return r},getVisibleVectorLayers:function(){var e=[],t=map.getLayersByClass("OpenLayers.Layer.Vector");return $.each(t,function(t,a){return a.hasOwnProperty("print")&&!a.print?!0:(a.visibility&&a.features.length>0&&e.push(a),void 0)}),e}},coordinates={active:!1,panel:null,init:function(){null==this.panel&&(this.panel=$("#advance-goto-panel"),this.button=$("#gis_goToCoordinatesBtn"),this.inputX=$("#coords-lon"),this.inputY=$("#coords-lat"),this.inputXLabel=$("#coords-lon-label"),this.inputYLabel=$("#coords-lat-label"),this.selectEpsg=$("#coords-epsg"),$("#coords-epsg").change(function(){var e=$("#coords-epsg option:selected").val();"EPSG:32616"===e?(coordinates.inputXLabel.data("locale_key","GoTo_Coords_X"),coordinates.inputYLabel.data("locale_key","GoTo_Coords_Y")):(coordinates.inputXLabel.data("locale_key","GoTo_Coords_Lon"),coordinates.inputYLabel.data("locale_key","GoTo_Coords_Lat")),coordinates.inputX.val(""),coordinates.inputY.val(""),LocaleManager.refreshLocalizedElement(coordinates.inputXLabel),LocaleManager.refreshLocalizedElement(coordinates.inputYLabel)})),this.openPanel()},toggle:function(e){e.hasClass("btn-active")?this.deactivate(e):this.activate(e)},activate:function(e){e.addClass("btn-active"),this.init(),this.active=!0},deactivate:function(e){(e||null!=this.button)&&(e=this.button,e.removeClass("btn-active"),this.closePanel(),this.resetPanel(),this.active=!1)},openPanel:function(){this.panel.show()},closePanel:function(){null!=this.panel&&this.panel.hide()},resetPanel:function(){Utils.cleanForm(this.panel)},goToCoordinates:function(){var e={};if(e.epsg=this.selectEpsg.val(),e.x=this.inputX.val(),e.y=this.inputY.val(),""!=e.x.trim()&&""!=e.y.trim()){var t=new OpenLayers.LonLat(e.x,e.y);map.setCenter(t.transform(new OpenLayers.Projection(e.epsg),map.getProjection()),12)}}},gisOverview={active:!1,panel:null,showButton:function(){$("#gis_gisOverviewBtn").show()},init:function(){null==this.panel&&(this.panel=$("#gis-map-overview"),this.button=$("#gis_gisOverviewBtn"))},onToggleEventFn:function(){adjustTocHeight()},isShown:function(){var e=$("#gis_gisOverviewBtn").hasClass("btn-active");return e},toggle:function(e){e.hasClass("btn-active")?this.deactivate(e):this.activate(e),this.onToggleEventFn()},activate:function(e){e.addClass("btn-active"),this.init(),this.openOverview()},deactivate:function(e){(e||null!=this.button)&&(e=this.button,e.removeClass("btn-active"),this.closeOverview())},openOverview:function(){this.panel.show()},closeOverview:function(){this.panel.hide()}},kmlupload={active:!1,panel:null,fileInput:null,init:function(){this.panel=$("#advance-uploadkml-panel"),this.button=$("#gis-uploadkml"),this.fileTextField=$("#uploadkml-input-file-text"),$("#uploadkml-submit").button()},toggle:function(){null==this.panel&&this.init(),this.active===!1?this.activate():this.deactivate()},activate:function(){this.cleanForm();var e=this.button;e.addClass("btn-active"),this.active=!0,this.openPanel()},deactivate:function(){null==this.panel&&this.init();var e=this.button;e.removeClass("btn-active"),this.active=!1,this.closePanel()},openPanel:function(){this.panel.show()},closePanel:function(){this.panel.hide()},chooseFile:function(){this.fileInput=(new KmlUploader).chooseFile(this.fileTextField)},uploadKml:function(){var e=this.getKmlUploadDataForm();(new KmlUploader).uploadKml(e,function(){kmlupload.deactivate()},function(){alert("fail")})},cleanForm:function(){$("#uploadkml-extractstyles").attr("checked",!1),$("#uploadkml-extractattributes").attr("checked",!1),$("#uploadkml-input-file-text").val("")},getKmlUploadDataForm:function(){var e={};return e.fileInput=this.fileInput,e.groupName="Kml",e.projection=$("#uploadkml-select-proj").val(),e.extractStyles=$("#uploadkml-extractstyles").is(":checked"),e.extractAttributes=$("#uploadkml-extractattributes").is(":checked"),e}},KmlUploader=function(){this.uploadKml=function(e,t,a){var i=e.fileInput[0],n=i.files[0],r=new FileReader,l=n.name,o=e.groupName;r.onload=function(){var i=null;try{strKML=r.result,console.log(strKML);var n=new OpenLayers.Format.KML({internalProjection:map.getProjectionObject(),externalProjection:new OpenLayers.Projection(e.projection),extractStyles:e.extractStyles,extractAttributes:e.extractAttributes}),s=n.read(strKML);if(0>=s.length&&(alert("No features in file..."),!Utils.isNullOrUndefined(a)))return a(),void 0;var i=new OpenLayers.Layer.Vector(l,{displayInLayerSwitcher:!1,projection:new OpenLayers.Projection(map.getProjection())});i.addFeatures(s)}catch(c){if(alert("Error parsing the KML file..."),!Utils.isNullOrUndefined(a))return a(),void 0}map.addLayer(i);var u=i.getDataExtent(),d={source:"kml",title:l,enabled:!0,bounds:u,group:o},g=new LayerConfig(d);catalog.addLayerToConfig(g),LayerMenu.addToSelectedLayerMenu({id:g.getId(),layerOL:i,enabled:!0,hasDelete:!0,hasLegend:!1}),zoomToExtent(u,!0),map.zoomOut(),Utils.isNullOrUndefined(t)||t()},r.readAsText(n)},this.chooseFile=function(e){$("#uploadkml-input-file").length>0&&$("#uploadkml-input-file").remove();var t=$("<input>").attr("id","uploadkml-input-file").attr("type","file").change(function(){var t=$(this)[0],a=t.files[0];a.name.match(/\.(kml)$/)?e.val(a.name):alert("File not supported, kml files only")});return $("body").append(t),t.click(),t},this.uploadKmlAutomaticTest=function(){var e=$("<input>").attr("type","file").change(function(){var e=$(this)[0],t=e.files[0];if(t.name.match(/\.(kml)$/)){var a=new FileReader;a.onload=function(){strKML=a.result,console.log(strKML);var e={source:"kml",title:"test_title",enabled:!0,group:"ppppppp"},t=new LayerConfig(e);catalog.addLayerToConfig(t);var i=new OpenLayers.Format.KML({internalProjection:map.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4326"),extractStyles:!0,extractAttributes:!0}),n=i.read(strKML),r=new OpenLayers.Layer.Vector("test kml",{displayInLayerSwitcher:!1,projection:new OpenLayers.Projection(map.getProjection())});map.addLayer(r),r.addFeatures(n);var l=$("<div>",{id:"menu_ppppppp","class":"root_item"}),o=$("<div>",{"class":"menu_title"}).click(function(){toggleMenuItemContent($(this).parents(".root_item"))}),s=$("<div>").addClass("root_icon root_icon_collapsed"),c=$("<div>").addClass("root_text").text("ppppppp");o.append(s,c);var u=$("<div>").addClass("menu_item_content custom-hidden").append($("<ul>").addClass("menu_item_content_list"));l.append(o,u);var d=$("#tab_layers");d.append(l),LayerMenu.addToMenu(t,r,!0,!0,!1)},a.readAsText(t)}else alert("File not supported, kml files only")});$("body").append(e),e.click()}},catalogCsw=null;catalogCsw={active:!1,vLayer:null,bbox:null,vPanel:null,dialogDiv:null,vResultPanelBody:null,vSearchForm:null,defaultEPSG:"EPSG:4326",defaultThumbnail:"images/banner/logo_icf_scalata.png",getMetadataUrlDetails:function(){return"es"===LocaleManager.locale?GEONETWORK_URL+"/srv/spa/metadata.show?uuid=":GEONETWORK_URL+"/srv/eng/metadata.show?uuid="},fields:{description:LocaleManager.getKey("Metadata_Label_Description"),date:LocaleManager.getKey("Metadata_Label_Date"),"abstract":LocaleManager.getKey("Metadata_Label_Abstract")},toggle:function(e){e.hasClass("btn-active")?this.deactivate(e):this.activate(e)},activate:function(e){e.addClass("btn-active"),this.init(),this.active=!0},deactivate:function(e){e||(e=$("#gis_cswClientBtn")),e.removeClass("btn-active"),this.closePanel(),this.active=!1},openPanel:function(){null!=this.dialogDiv&&this.dialogDiv.dialog("open")},closeCallbackFn:function(){this.cleanAll()},closePanel:function(){null!=this.dialogDiv&&this.dialogDiv.dialog("close"),null!=this.vLayer&&this.vLayer.removeAllFeatures()},cleanAll:function(){this.cleanSearchResults(),this.cleanSearchParameters()},cleanSearchResults:function(){this.vResultPanelBody.empty()},cleanSearchParameters:function(){Utils.cleanForm(this.vSearchForm)},searchBboxToggled:function(e){e.is(":checked")?$("#csw-catalog-bbox-panel").show():(null!=this.vLayer&&(this.vLayer.removeAllFeatures(),controls.catalog.deactivate(),$("#csw-catalog-bbox-selected-text").text("")),$("#csw-catalog-bbox-panel").hide(),$("#csw-catalog-bbox-toggle-button").addClass("custom-hidden"))},setBboxSelectedText:function(){$("#csw-catalog-bbox-selected-text").text(LocaleManager.getKey("Advanced_Panel_Search_SearchBboxSelectedText")),$("#csw-catalog-bbox-toggle-button").removeClass("custom-hidden")},toggleVisibilityBbox:function(){null!=this.vLayer&&(this.vLayer.setVisibility(!this.vLayer.getVisibility()),this.vLayer.getVisibility()?($("#csw-catalog-bbox-toggle-button i").removeClass("fa-eye-slash").addClass("fa-eye"),$("#csw-catalog-bbox-toggle-button").data("locale_key","Advanced_Panel_Search_SearchBboxHideButton")):($("#csw-catalog-bbox-toggle-button i").removeClass("fa-eye").addClass("fa-eye-slash"),$("#csw-catalog-bbox-toggle-button").data("locale_key","Advanced_Panel_Search_SearchBboxShowButton")),LocaleManager.refreshLocalizedElement($("#csw-catalog-bbox-toggle-button")))},viewCatalogData:function(e){this.init(),this.cleanSearchResults(),$.each(e.records,function(e,t){var a=new CswRecord(t,catalogCsw.fields);catalogCsw.vResultPanelBody.append(catalogCsw.getDomRecord(a))}),this.openPanel()},getDomRecord:function(e){var t=$("<div>").attr({"class":"catalog-rec"}).data({record:e}),a=$("<div>").attr({"class":"catalog-rec-header"}).append(this.getDomImageHeader(),this.getDomTitle(e),this.getDomSource(e)),i=$("<div>").attr({"class":"catalog-rec-body custom-hidden"}),n=$("<div>").attr({"class":"catalog-rec-body-left"}).append(this.getDomThumbnail(e)),r=$("<div>").attr({"class":"catalog-rec-body-right"}),l=this.getDomButtons(e);return $.each(e.getProperties(),function(t){var a=catalogCsw.getDomRecordDetails(e,t);r.append(a)}),i.append(n,r,l),t.append(a,i),t},getDomRecordDetails:function(e,t){var a=$("<div>").attr({"class":"details-container"}),i=$("<div>").attr({"class":"details-title"}).text(e.getPropertyName(t));return a.append(i),$.each(e.getValuesProperty(t),function(e,t){var i=$("<div>").attr({"class":"detail-container"}).text(t);a.append(i)}),a},getDomImageHeader:function(){var e=$("<div>").attr({"class":"header-image item"}).append($("<i>").attr({"class":"fa fa-caret-right fa-2x"})).click(function(){var e=$(this).closest(".catalog-rec").find(".catalog-rec-body");e.is(":visible")?(e.hide(),$(this).find("i").removeClass("fa-caret-down").addClass("fa-caret-right")):(e.show(),$(this).find("i").removeClass("fa-caret-right").addClass("fa-caret-down"))});return e},getDomTitle:function(e){var t=$("<div>").attr({"class":"catalog-rec-title item"}).text(e.getTitle());return t},getDomSource:function(e){var t=$("<div>").attr({"class":"catalog-rec-source item"}).text(e.getSource());return t},getDomButtons:function(e){var t,a,i,n=$("<div>").attr({"class":"catalog-rec-buttons"}),r=e.getUrl();null!=r&&""!=r&&(t=$("<div>").html(LocaleManager.getKey("Metadata_Label_Button_AddToMap")).append($("<i>").attr({"class":"fa fa-external-link fa-2x"})).click(function(){var e=$(this).parents(".catalog-rec").data("record"),t=r,a=e.getName(),i=e.getTitle(),n=LayerMenu.getLayerLIFromMenu(e.getUrl(),e.getName());Utils.isNullOrUndefined(n)?addSingleWMSLayerFromGeoNetwork(a,i,t):LayerMenu.selectAndOpenLayerInMenu(n)}));var l=e.getId();null!=l&&""!=l&&(a=$("<div>").html(LocaleManager.getKey("Metadata_Label_Button_Details")).append($("<i>").attr({"class":"fa fa-info fa-2x"})).click(function(){loadGeonetworkUrlInIframe(catalogCsw.getMetadataUrlDetails()+l,!0)}));var o=e.getBbox();return null!=o&&(i=$("<div>").html(LocaleManager.getKey("Metadata_Label_Button_CenterMap")).append($("<i>").attr({"class":"fa fa-search-plus fa-2x"})).click(function(){var e=null;o.hasOwnProperty("left")&&o.hasOwnProperty("bottom")&&o.hasOwnProperty("right")&&o.hasOwnProperty("top")&&(e=catalogCsw.getProperBboxFromCSWResponse(o)),null!=e&&(e.transform(new OpenLayers.Projection(catalogCsw.defaultEPSG),new OpenLayers.Projection(map.getProjection())),map.zoomToExtent(e,!0))})),n.append(t,a,i),n},getDomThumbnail:function(e){var t="";t=null!=e.getThumbnail()?e.getThumbnail():this.defaultThumbnail;var a=$("<div>").attr({"class":"catalog-thumbnail"}).append($("<img>").attr({src:t}));return a},getDataForm:function(){var e={},t=!1;if(""==$("#catalog-input-keyword").val())e.freeText=null;else{var a=$("#catalog-input-keyword").val();a=a.trim(),t||(a="*"+a+"*"),e.freeText=a}if(""==$("#catalog-input-datefrom").val()?null==e.lastModifiedBegin:e.lastModifiedBegin=$("#catalog-input-datefrom").val(),e.lastModifiedEnd=""==$("#catalog-input-dateto").val()?null:$("#catalog-input-dateto").val(),""==$("#catalog-input-title").val())e.title=null;else{var i=$("#catalog-input-title").val();t||(i="*"+i+"*"),e.title=i}if(e.useBbox=$("#catalog-input-bbox").is(":checked"),e.useBbox===!0){var n=null;null!=this.vLayer&&this.vLayer.features.length>0&&(n=this.vLayer.features[0].geometry.getBounds()),e.bounds=n}return e},getProperBboxFromCSWResponse:function(e){var t=null;return e.left<e.right?t=new OpenLayers.Bounds(e.left,e.bottom,e.right,e.top):e.left>e.right&&(t=new OpenLayers.Bounds(e.right,e.bottom,e.left,e.top)),t},requests:{getData:function(){var e=catalogCsw.getDataForm();catalogCsw.cleanSearchResults(),loadingImage(catalogCsw.vResultPanelBody,!0);var t=new CswClient({});t.search(e,function(e){catalogCsw.viewCatalogData(e)},function(){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("Metadata_Csw_Error_Requests"))})}},initLayer:function(){null==this.vLayer&&(this.vLayer=new OpenLayers.Layer.Vector("bboxCSWsearch",{displayInLayerSwitcher:!1,styleMap:StyleManager.getRedlineStyle(),projection:new OpenLayers.Projection(map.getProjection()),eventListeners:{beforefeatureadded:function(e){catalogCsw.vLayer.removeAllFeatures(),srid=e.feature.layer.projection.projCode,e.feature.geometry.transform(new OpenLayers.Projection(srid),new OpenLayers.Projection(map.getProjection()))}}}),this.vLayer.alwaysOnTop=!0,map.addLayer(this.vLayer))},init:function(){if(null==this.vPanel){this.vPanel=$("#catalog"),this.vResultPanelBody=$("#catalog-body"),this.vSearchForm=$("#catalog-form"),this.button=$("#gis_cswClientBtn");var e={closeFn:function(){catalogCsw.closeCallBackFn},height:315,width:"90%",resizable:!1,modal:!1,extensions:!0,collapsable:!0};this.dialogDiv=DialogUtils.renderDialog("Metadata catalog",{},e,this.vPanel),$("#catalog-input-advanced").change(function(){$(this).is(":checked")?$("#catalog-form-advanced").show():$("#catalog-form-advanced").hide()}),$("#catalog-input-datefrom").datepicker({changeMonth:!0,onClose:function(e){$("#catalog-input-dateto").datepicker("option","minDate",e)}}),$("#catalog-input-dateto").datepicker({changeMonth:!0,onClose:function(e){$("#catalog-input-datefrom").datepicker("option","maxDate",e)}})}this.openPanel()}};var featureInfoResults={init:function(){},initLayer:function(){var e=new OpenLayers.Layer.Vector("featureinfolayer",{displayInLayerSwitcher:!1,styleMap:StyleManager.getRedlineStyle(),projection:new OpenLayers.Projection(map.getProjection()),print:!1});return e},showWMSGetFeatureInfoDialog:function(e){this.init();var t=$("<div>").attr({"class":"info-container"});if(e.features&&e.features.length){$.each(e.features,function(e,a){var i=featureInfoResults.buildFeatureInfoDiv(a);t.append(i)});var a=$("<div>",{title:LocaleManager.getKey("GetFeature_Info_Dialog_Title")}),i={};i[LocaleManager.getKey("General_Close")]=function(){$(this).dialog("close")},a.dialog({autoOpen:!1,modal:!0,width:"auto",minWidth:"200",resizable:!1,close:function(){$(this).dialog("destroy").remove()},buttons:i}),a.append(t),a.dialog("open")}},getGidFromFid:function(e){var t=e.split(".");return t[t.length-1]},buildFeatureInfoDiv:function(e){var t=$("<div>").attr({"class":"info-feat-cont"}),a=$("<div>").attr({"class":"info-feat-header"}),i=selectedLayerTree.getSelectedLayer(),n=i.data("title"),r=i.data("id"),l=catalog.getLayerConfigById(r),o="",s=l.getAttributeNameForInfo();if(Utils.isNullOrUndefined(s)){if(!Utils.isNullOrUndefined(e.fid)){var c=this.getGidFromFid(e.fid);o="#"+c}}else if(e.attributes.hasOwnProperty(s))o="- "+e.attributes[s];else{var c=this.getGidFromFid(e.fid);o="#"+c}var u=n+" "+o,d=$("<div>").attr({"class":"info-header-text"}).text(u),g=$("<div>").attr({"class":"info-icon-toggle-view"}).append($("<i>").attr({"class":"fa fa-caret-right"})).click(function(e){e.stopPropagation(),featureInfoResults.toggleViewInfoItem($(this))});a.append(g,d);var p=$("<div>").attr({"class":"info-feat-body custom-hidden"});return p.data("feature",e),$.each(e.attributes,function(e,t){if(e===GLOBAL_SETTINGS.featureInfoHyperlinkField){var a=$("<div>").addClass("info-hyperlink-container").append($("<div>").text(LocaleManager.getKey("GetFeature_Info_Hyperlink_Title")),$("<a>").attr({href:t,target:target="_blank"}).text(t));return p.append(a),!1}}),$.each(e.attributes,function(e,t){if(e===GLOBAL_SETTINGS.featureInfoHyperlinkField)return!0;var a=$("<div>").attr({"class":"info-row"}),i=$("<div>").attr({"class":"info-icon-row"}).append($("<i>").attr({"class":"fa fa-circle"})),n=$("<div>").attr({"class":"info-left"}).text(e),r=$("<div>").attr({"class":"info-right word-wrap"}).text(t);a.append(i,n,r),p.append(a)}),t.append(a,p),t},toggleViewInfoItem:function(e){var t=e.closest(".info-feat-cont").find(".info-feat-body");t.is(":visible")?($(".info-icon-toggle-view i").removeClass("fa-caret-down").addClass("fa-caret-right"),$(".info-feat-body").hide()):(t.data("feature"),$(".info-feat-body").hide(),$(".info-icon-toggle-view i").removeClass("fa-caret-right").addClass("fa-caret-down"),t.slideDown("fast"))},parseGridDataFromResponse:function(e){var t=[],a=$.parseJSON(e.text),i={};return $.each(a.features,function(e,a){var n=a,r=a.id,l=0,o=n.properties;$.each(o,function(e,a){l++;var i={cell:[e,a]};t.push(i)});var s={total:l,page:1,rows:t};i[r]=s}),i},showKMLGetFeatureInfoDialog:function(e){this.init();var t=$("<div>").attr({"class":"info-container"}),a=featureInfoResults.buildFeatureInfoDiv(e.feature);t.append(a);var i=$("<div>",{title:LocaleManager.getKey("GetFeature_Info_Dialog_Title")}),n={};n[LocaleManager.getKey("General_Close")]=function(){$(this).dialog("close"),controls.KMLFeatureInfo.unselectAll()},i.dialog({autoOpen:!1,modal:!0,width:"auto",minWidth:"200",resizable:!1,close:function(){$(this).dialog("destroy").remove()},buttons:n}),i.append(t),i.dialog("open")}};AlertDialog.configurationError="Error constructing AlertDialog.",AlertDialog.createConfirmDefaultDialog=function(e,t,a,i){var n={};n[LocaleManager.getKey("General_Confirm")]=function(){Utils.isNullOrUndefined(a)||a(),$(this).dialog("close")},n[LocaleManager.getKey("General_Cancel")]=function(){Utils.isNullOrUndefined(i)||i(),$(this).dialog("close")};var r=AlertDialog.buildDialog({isToCreate:!0,title:e,message:t,type:"question",buttons:n});return r},AlertDialog.createOkDefaultDialog=function(e,t,a,i){AlertDialog.createOkDialog({title:e,message:t,okButton:!0,type:a,okFn:i})},AlertDialog.createOkDialog=function(e){e.isToCreate=!0,AlertDialog.buildDialog(e)},AlertDialog.buildDialog=function(e){var t="",a=!1,i="ui-icon-check",n=e.buttons,r=e.element;switch(Utils.isNullOrUndefined(r)&&(r=$("<div>")),!Utils.isNullOrUndefined(e.isToCreate)&&e.isToCreate&&(a=e.isToCreate),Utils.isNullOrUndefined(n)&&(n={},n[LocaleManager.getKey("AlertDialog_OK")]=function(){Utils.isNullOrUndefined(e.okFn)||e.okFn(),$(this).dialog("close")}),e.type){case"info":break;case"checked":break;case"error":t="ui-state-error",i="ui-icon-alert";break;case"question":i="ui-icon-help"}var l=$("<p>").append($("<div>",{"class":"ui-icon-left"}).append($("<span>",{"class":"ui-icon "+i}),$("<div>",{"class":"message-dialog"}).html(e.message)));return r.addClass(t).append(l),r.dialog({title:e.title,autoOpen:a,modal:!0,resizable:!1,close:function(){e.isToCreate&&$(this).dialog("destroy").remove()},buttons:n}),r},CreateLayer.createOLLayer=function(e){var t=null;switch(e.getSource()){case"osm":t=CreateLayer.createOSMLayer(e);break;case"google":t=CreateLayer.createGoogleLayer(e);break;case"bing":t=CreateLayer.createBingLayer(e);break;case"wms":t=CreateLayer.createWMSLayer(e);var a=!1;Utils.isTrue(e.isEnabled())&&(a=!0),t.setVisibility(a);break;case"wms_multi_layer":t=CreateLayer.createWMSMultiLayer(e)}return t},CreateLayer.createOSMLayer=function(e){var t=new OpenLayers.Layer.OSM(e.getTitle());return t},CreateLayer.createBingLayer=function(e){var t=null;return"ROAD"===e.getName()?t=new OpenLayers.Layer.Bing({name:"Road",key:BING_APIKEY,type:"Road"}):"HYBRID"===e.getName()?t=new OpenLayers.Layer.Bing({name:"Hybrid",key:BING_APIKEY,type:"AerialWithLabels"}):"AERIAL"===e.getName()&&(t=new OpenLayers.Layer.Bing({name:"Aerial",key:BING_APIKEY,type:"Aerial"})),t},CreateLayer.createGoogleLayer=function(e){var t=null;return"ROADMAP"===e.getName()?t=new OpenLayers.Layer.Google(e.getTitle(),{numZoomLevels:20,visibility:!1}):"SATELLITE"===e.getName()?t=new OpenLayers.Layer.Google(e.getTitle(),{type:google.maps.MapTypeId.SATELLITE,numZoomLevels:20,visibility:!1}):"HYBRID"===e.getName()?t=new OpenLayers.Layer.Google(e.getTitle(),{type:google.maps.MapTypeId.HYBRID,numZoomLevels:20,visibility:!1}):"TERRAIN"===e.getName()&&(t=new OpenLayers.Layer.Google(e.getTitle(),{type:google.maps.MapTypeId.TERRAIN,numZoomLevels:20,visibility:!1})),t},CreateLayer.createWMSLayer=function(e){var t=e.getOpenLayersOptions();if(t.tileSize){var a=t.tileSize[0],i=t.tileSize[1];t.tileSize=new OpenLayers.Size(a,i)}var n=e.getCacheUrl(),r="mosef:"+e.getName();Utils.isNullOrUndefined(n)&&(n=e.getUrl(),r=e.getName());var l={LAYERS:r,STYLES:"",format:e.getWMSOptions().format,transparent:e.getWMSOptions().transparent},o=e.getSldUrl();Utils.isNullOrUndefined(o)||(l.sld=o);var s=new OpenLayers.Layer.WMS(e.getTitle(),n,l,t);return s},CreateLayer.createWMSMultiLayer=function(e){var t=e.getOpenLayersOptions();if(t.tileSize){var a=t.tileSize[0],i=t.tileSize[1];t.tileSize=new OpenLayers.Size(a,i)}var n=e.getEnabledLayerNamesForWMSMulti(),r=new OpenLayers.Layer.WMS(e.getUrl(),e.getUrl(),{LAYERS:n,STYLES:"",format:e.getWMSOptions().format,transparent:e.getWMSOptions().transparent},t);return r},LoadLayersUtils.filterBaseLayerFromConfig=function(e){var t=e.filter(function(e){var t=e.getGroup(),a=LayerMenu.isBackgroundGroup(t);return a===!0});return t},LoadLayersUtils.loadLayersFromConfig=function(e,t,a){var i=LoadLayersUtils.filterBaseLayerFromConfig(t);i=i.sort(function(e,t){return e.getPosition()<t.getPosition()?-1:e.getPosition()>t.getPosition()?1:0}),LoadLayersUtils.loadBaseLayersFromConfig(i);var n=Utils.orderByAttribute(e.layersGroups,"position","asc");$.each(n,function(e,a){var i=a.code;if(LayerMenu.isBackgroundGroup(i))return!0;var n=t.filter(function(e){return e.layerConfig.group===i}),r=n.sort(function(e,t){return e.getPosition()>t.getPosition()?-1:e.getPosition()<t.getPosition()?1:0});$.each(r,function(e,t){LoadLayersUtils.loadStdLayer(t,null)})}),Utils.isNullOrUndefined(a)||a()},LoadLayersUtils.loadStdLayer=function(e,t,a){var i=CreateLayer.createOLLayer(e),n=!1,r=!0;Utils.isTrue(e.isEnabled())&&(n=!0),"wms"==e.getSource()?LayerMenu.addToMenu(e,i,n,a,r):"wms_multi_layer"==e.getSource()&&LayerMenu.addMultiLayerToMenu(e,i,a),Utils.isNullOrUndefined(t)||t()},LoadLayersUtils.loadStdLayerInSelectedLayerTreeFromOutside=function(e,t){var a=selectedLayerTree.getAllLayersSize();if(a+1>GLOBAL_SETTINGS.maxNumberOfSelectedLayers)return AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),LocaleManager.getKey("Page_Menu_Selected_Layers_Max_Size")),void 0;var i=CreateLayer.createOLLayer(e);i.setVisibility(!0),map.addLayer(i),LayerMenu.addToSelectedLayerMenu({id:e.getId(),layerOL:i,enabled:!0,hasDelete:!0,hasLegend:!1}),Utils.isNullOrUndefined(t)||t()},LoadLayersUtils.loadBaseLayersFromConfig=function(e){$.each(e,function(e,t){var a=CreateLayer.createOLLayer(t);LayerMenu.addToBaseLayersMenu(t,a),map.addLayer(a),a.setVisibility(!1),a.setIsBaseLayer(!0)}),LoadLayersUtils.enableActiveBaseLayerFromComboBox()},LoadLayersUtils.enableActiveBaseLayerFromComboBox=function(){var e=$("#baselayers-select"),t=null;if($.each(e.find("option"),function(a,i){return $(i).data("enabled")?(e.val($(i).val()),t=$(i),!1):void 0}),null==t){var a=$("#baselayers-select option:first");a.length>0&&(t=$(a[0]))}Utils.isNullOrUndefined(t)||LoadLayersUtils.setActiveBaseLayer(t)},LoadLayersUtils.setActiveBaseLayer=function(e){var t=e.data("layerOl");$.each($("#baselayers-select option"),function(e,t){$(t).data("layerOl").setVisibility(!1)}),map.setBaseLayer(t),map.baseLayer.setVisibility(!0)},Proj4js.defs["EPSG:4248"]="+proj=longlat +ellps=intl +towgs84=-288,175,-376,0,0,0,0 +no_defs",Proj4js.defs["EPSG:32616"]="+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs";var catalog=new LayerConfigCatalog,initialLoadingPanel=null,topMenuTabs=null,userPermissions,map,tree,selectedLayerTree,mapControls={},mapExportCtrl=null,configLoaded=!1,groupsConfigLoaded=!1;$(window).resize(adjustTocHeight),$(document).ready(function(){adjustTocHeight(),AjaxPrefilter.activateProxyFilter(OL_PROXY_URL),LocaleManager.refreshLocale();var e=LocaleManager.getCurrentLocale();$("#language-selector").val(e),tree=new TreeMenu($("#tab_layers")),selectedLayerTree=new TreeMenu($("#tab_layers_active")),featureGridPanel=new FeatureGridPanel,LayerMenu.initOrderingSelectedLayerPanel(),searchP.init(),$.ajax({url:"login",type:"GET",dataType:"json",data:{oper:"currentUser"},cache:!1}).done(function(e){e.success===!0&&($("gis_login").prop("disabled",!0),$("#login_username,#login_password").prop("disabled",!0).hide(),$("#login_username_label, #login_password_label").hide(),$("#logged-welcome").text(LocaleManager.getKey("AlertDialog_Info_LoggedWelcome")+e.result.username).addClass("logged-welcome-visible"),$("#gis_login").hide(),$("#gis_logout").show(),userPermissions=new UserPermission(e.result)),init()})}),$(function(){$("#tab_webgis").text(LocaleManager.getKey("Tab_Menu_Webgis")),$("#tab_gn").text(LocaleManager.getKey("Tab_Menu_Geonetwork")),$("a.tabref").click(function(){"View"===$(this).text()?($("#tabs-gn").addClass("custom-hidden"),$("#tabs-webgis").removeClass("custom-hidden")):($("#tabs-webgis").addClass("custom-hidden"),$("#tabs-gn").removeClass("custom-hidden"))}),$("#gis_prevBtn").click(function(){mapControls.navControl.previous.active&&mapControls.navControl.previousTrigger()}),$("#gis_nextBtn").click(function(){mapControls.navControl.next.active&&mapControls.navControl.nextTrigger()}),$("#gis_logout").button().click(function(){$.ajax({url:"login",type:"GET",dataType:"json",cache:!1,data:{oper:"logout"}}).done(function(e){e.success===!0?location.reload(!0):AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Warning_Title"),e.msg)}).fail(function(e,t,a){throw AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_LogOut")+a),"error logout"}).error(function(e,t,a){AlertDialog.createOkDefaultDialog(LocaleManager.getKey("AlertDialog_Error_Title"),LocaleManager.getKey("AlertDialog_Error_LogOut")+a)})}),$("#gis_login").button().click(function(){submitLogin()}),$("#login_username, #login_password").keyup(function(e){13==e.keyCode&&""!=$("#login_username").val()&&""!=$("#login_password").val()&&submitLogin()}),$("#gis_maxExtentBtn").click(function(){zoomToDefaultMapCenter()}),$("#gis_getFeatureInfoBtn").click(MenuButtons.featureInfoComponentClicked),$("#gis_downloadBtn").click(MenuButtons.downloadButtonClicked),$("#gis_measureLineBtn").click(function(){var e=$(this).hasClass("btn-active");return e?(controls.measure.deactivate("line"),void 0):(controls.measure.activate("line"),void 0)}),$("#gis_measureAreaBtn").click(function(){var e=$(this).hasClass("btn-active");return e?(controls.measure.deactivate("polygon"),void 0):(controls.measure.activate("polygon"),void 0)}),$("#baselayers-select").change(function(){LoadLayersUtils.setActiveBaseLayer($(this).find("option:selected"))}),$("#input-label").keyup(function(e){13==e.keyCode&&saveLabel()}),$("#gis_information_message").click(function(){var e=$("#gis_information_popup").is(":visible");e===!0?$("#gis_information_popup").hide():($("#gis_information_popup").html(GENERAL_SETTINGS.informationMessage),$("#gis_information_popup").show())}),$("#save-label-button").button(),$("#search-bbox-select-button").button(),$("#search-bbox-toggle-button").button(),$("#csw-catalog-bbox-select-button").button(),$("#csw-catalog-bbox-toggle-button").button(),$("#print-submit").button(),$("#print-reload").button(),$("#data-grid-insert-submit").button(),$("#data-grid-update-submit").button(),$("#data-grid-update-cancel").button(),$("#data-grid-insert-cancel").button(),$("#alerts-update-modgeom").button(),$("#alerts-point-insert").button(),$("#simple-alerts-point-insert").button(),$(".status-actions").button(),$("#goto-coordinates-btn").button(),Utils.enableTooltip()
});var MapfishPrint=function(){this.outputFileName=Print_Configuration.outputFileName,this.outputFormat="pdf";var e=this;this.createMapfishOsm=function(){var e={type:"Osm",opacity:1,customParams:{},baseURL:"http://tile.openstreetmap.org/",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],tileSize:[256,256],resolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135],extension:"png"};return e},this.createMapfishGoogle=function(e){var t={type:"tiledGoogle",opacity:1,baseURL:"http://maps.google.com/maps/api/staticmap",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34],resolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],extension:"jpeg",format:"image/jpeg",sensor:!1,maptype:e.toLowerCase()};return t},this.getPropertiesRules=function(e){for(var t={},a=0;e.length>a;a++){var i=e[a].symbolizer;if(e[a].hasOwnProperty("filter")){var n=e[a].filter.property,r=e[a].filter.value;if(t.hasOwnProperty(n))t[n][r]=i;else{var l={};l[r]=i,t[n]=l}}else e[a].hasOwnProperty("elseFilter")&&(t.elseFilter=i)}return t},this.getFeatPropertyRule=function(e,t){var a=e.attributes,i=null;for(var n in t){if(a.hasOwnProperty(n)){i=n;break}i="elseFilter"}return i},this.getStyleFeatureFromRules=function(e,t,a,i){var n=null;return n="elseFilter"!=t?e[t][a][i]:e.elseFilter[i]},this.getStyleFeature=function(e,t){var a=null;if(t.hasOwnProperty("style")&&!Utils.isNullOrUndefined(t.style))return a=t.style;if(e.styleMap.styles["default"].hasOwnProperty("rules")&&e.styleMap.styles["default"].rules.length>0){var i=this.getPropertiesRules(e.styleMap.styles["default"].rules),n=this.getFeatPropertyRule(t,i),r=t.attributes[n],l=Utils.getGeomTypeForPrint(t.geometry.CLASS_NAME.split(".")[2]);a=this.getStyleFeatureFromRules(i,n,r,l)}else a=e.styleMap.styles["default"].defaultStyle;return a},this.createPrintVector=function(e){var t={type:"Vector",styles:{"":{}},styleProperty:"_style",geoJson:{type:"FeatureCollection",features:e}};return t},this.getLayersForPrint=function(){for(var e=[],t=print.getVisibleVectorLayers(),a=0;t.length>a;a++){for(var i=t[a],n=i.features,r=[],l=0;n.length>l;l++){var o=n[l],s=(new OpenLayers.Format.GeoJSON).write(o,!1),c=JSON.parse(s),u=this.getStyleFeature(i,o);c.properties._style=u,Utils.isNullOrUndefined(c.properties.label)||(c.properties._style.label=c.properties.label,c.properties._style.labelYOffset="-10"),r.push(c)}var d=this.createPrintVector(r);e.push(d)}var g=selectedLayerTree.getVisibleLayers();Utils.isNullOrUndefined(g)||$.each(g,function(t,a){var i=$(a).data("id"),n=catalog.getLayerConfigById(i),r=$(a).data("title"),l=$(a).data("layerOL"),o=l.opacity,s=null;if("wms"===n.getSource())s=n.getName();else{if("wms_multi_layer"!==n.getSource())return!0;s=n.getNameByTitle(r)}var c=n.getUrl(),u=[];u.push(s);var d={type:"WMS",format:n.getFormat(),layers:u,baseURL:c,opacity:o};e.push(d)});var p=LayerMenu.getSelectedBasemapLayer();if("osm"===p.getSource()){var f=this.createMapfishOsm();e.push(f)}else if("google"===p.getSource()){var h=p.getName(),y=this.createMapfishGoogle(h);e.push(y)}else if("wms"===p.getSource()){var m=p.getName(),v=p.getUrl(),L=[];L.push(m);var b=p.getDefaultOpacity(),C={type:"WMS",format:p.getFormat(),layers:L,baseURL:v,opacity:b};e.push(C)}else if("wms_multi"===p.getSource()){var _=layerConfig_i.getAllLayerNamesForWMSMulti(),v=layerConfig_i.getUrl(),b=p.getDefaultOpacity(),C={type:"WMS",format:layerConfig_i.getFormat(),layers:_,baseURL:v,opacity:b};e.push(C)}return e.reverse()},this.getLegendLayers=function(){var t=[],a=print.getVisibleVectorLayers();Utils.isNullOrUndefined(a)||$.each(a,function(a,i){var n=i.name,r=e._createLegendForCustomVectorLayer(n);return Utils.isNullOrUndefined(r)?!0:(t.push(r),void 0)});var i=selectedLayerTree.getVisibleLayers();Utils.isNullOrUndefined(i)||$.each(i,function(a,i){var n=$(i).data("id"),r=$(i).data("title"),l=catalog.getLayerConfigById(n),o=e._createLegendForLayerConfig(l,r);return Utils.isNullOrUndefined(o)?!0:(t.push(o),void 0)});var n=LayerMenu.getSelectedBasemapLayer();if(!Utils.isNullOrUndefined(n)){var r=LayerMenu.getSelectedBasemapLayerTitle(),l=e._createLegendForLayerConfig(n,r);Utils.isNullOrUndefined(l)||t.push(l)}return t.reverse()},this._createLegendForCustomVectorLayer=function(e){var t=null;if("alerts"===e){var t={};t.name="Denuncias",t.classes=[];var a={},i=GLOBAL_SETTINGS.alertsLegendImageUrl,n="",r=!1;a.name=n,a.icon=i,a.iconBeforeName=r,t.classes.push(a)}else if("redlines"===e){var t={};t.name="Dibujos",t.classes=[];var a={},i=GLOBAL_SETTINGS.redlinesLegendImageUrl,n="",r=!1;a.name=n,a.icon=i,a.iconBeforeName=r,t.classes.push(a)}return t},this._createLegendForLayerConfig=function(e,t){var a=null;if("wms"===e.getSource())a=e.getName();else{if("wms_multi_layer"!==e.getSource())return;a=e.getNameByTitle(t)}var i=e.getUrl(),n={};n.name=t,n.classes=[];var r={},l=LegendGraphics.createGetLegendGraphicUrl(i,a),o="",s=!1;return r.name=o,r.icon=l,r.iconBeforeName=s,n.classes.push(r),n},this.getCenter=function(){var e=map.getCenter(),t=[];return t.push(e.lon),t.push(e.lat),t},this.doPrint=function(e){var t="A4 landscape";Utils.isNullOrUndefined(e.layout)||(t=e.layout);var a="";Utils.isNullOrUndefined(e.title)||(a=e.title);var i="";Utils.isNullOrUndefined(e.mapTitle)||(i=e.mapTitle);var n="";Utils.isNullOrUndefined(e.mapComment)||(n=e.mapComment);var r="";Utils.isNullOrUndefined(e.note)||(r=e.note);var l=4e6;Utils.isNullOrUndefined(e.scale)||(l=e.scale);var o=190;Utils.isNullOrUndefined(e.dpi)||(o=e.dpi);var s=0;Utils.isNullOrUndefined(e.rotationAngle)||""==e.rotationAngle||(s=e.rotationAngle);var c=catalog.getMapConfig().projection,u=catalog.getMapConfig().units,d=this.getLegendLayers(),g=!1;d.length>0&&(g=!0),!1===e.hasLegend&&(g=!1);var p={layout:t,title:a,srs:c,units:u,outputFilename:this.outputFileName,outputFormat:this.outputFormat,layers:this.getLayersForPrint(),rotationAngle:s,note:r,print_images_folder:GLOBAL_SETTINGS.printImagesFolder,mapTitle:i,dpi:o,hasLegend:g,pages:[{center:this.getCenter(),scale:l,rotation:s,data:[{id:1,name:"blah",icon:"icon_pan"},{id:2,name:"blip",icon:"icon_zoomin"}]}],legends:d};this.doMapfishPrintCall(p)},this.doMapfishPrintCall=function(e){var t=LocaleManager.getKey("Print_Wait_Message");loadingDialog.open("",t);var a=JSON.stringify(e);$.ajax({type:"POST",url:"../print-servlet-mod2/pdf/create.json",data:a,contentType:"application/pdf",asynch:!1,timeout:15e3,processData:!1}).done(function(e){loadingDialog.close(),location.href=e.getURL}).fail(function(){alert("print error"),loadingDialog.close()})}},CswRecord=function(e,t){this.params=e;var a=t;this.getParams=function(){return this.params},this.getProperties=function(){var e={};return $.each(this.params,function(t,i){0!=Utils.isInArray(t,a,"key")&&(e[t]=i)}),e},this.getPropertyName=function(e){return a[e]},this.getValuesProperty=function(e){var t=[];return $.each(this.params[e],function(a,i){return"abstract"===e?(t.push(i),!0):(t.push(i.value),void 0)}),t},this.getThumbnail=function(){var e=null;return $.each(this.params.URI,function(t,a){return"thumbnail"===a.name?(e=a.value,!1):void 0}),e},this.getTitle=function(){var e=null;return $.each(this.params.title,function(t,a){return a.hasOwnProperty("value")&&""!==a.value?(e=a.value,!1):void 0}),e},this.getUrl=function(){var e=null;return $.each(this.params.URI,function(t,a){return"thumbnail"!==a.name&&"large_thumbnail"!==a.name?(e=a.value,!1):void 0}),e},this.getSource=function(){var e=null;return $.each(this.params.source,function(t,a){return a.hasOwnProperty("value")&&""!==a.value?(e=a.value,!1):void 0}),e},this.getName=function(){var e=null;return $.each(this.params.URI,function(t,a){return"thumbnail"!==a.name&&"large_thumbnail"!==a.name?(e=a.name,!1):void 0}),e},this.getId=function(){return this.params.identifier[0].value},this.getBbox=function(){var e=null;return this.params.bounds&&this.params.bounds.hasOwnProperty("bottom")&&this.params.bounds.hasOwnProperty("top")&&this.params.bounds.hasOwnProperty("left")&&this.params.bounds.hasOwnProperty("right")&&(e=this.params.bounds),e},this.getEPSG=function(){var e=null;return this.params.projection&&""!=this.params.projection&&(e=this.params.projection.substring(this.params.projection.lastIndexOf("(")+1,this.params.projection.lastIndexOf(")"))),e}},CswClient=function(e){this.cswVersion=e.cswVersion?e.cswVersion:"2.0.2",this.filterVersion=e.filterVersion?e.filterVersion:"1.1.0",this.sortProperty=e.sortProperty?e.sortProperty:"Title",this.sortOrder=e.sortOrder?e.sortOrder:"ASC",this.limit=e.limi?e.limit:5,this.initialBBox={minx:-100,miny:0,maxx:100,maxy:80},this.titleProperty="title",this.lastModifiedBeginProperty="tempExtentBegin",this.lastModifiedEndProperty="tempExtentEnd",this.buildCSWRequestData=function(e){this.resultType=e.resultType?e.resultType:this.resultType,this.filterVersion=e.filterVersion?e.filterVersion:this.filterVersion,this.filter=e.filter?e.filter:this.filter,this.currentCatalog=e.url?e.url:this.currentCatalog,this.sortProperty=e.sortProperty?e.sortProperty:this.sortProperty,this.sortOrder=e.sortOrder?e.sortOrder:this.sortOrder;var t={url:e.XDProxy?e.XDProxy.url+"?"+e.XDProxy.callback+"="+e.url:e.url,resultType:"results",startPosition:e.start?e.start:1,maxRecords:this.limit?this.limit:10,outputFormat:"application/xml",outputSchema:"http://www.opengis.net/cat/csw/"+this.cswVersion};t.Query=null==this.filter||e.emptySearch?{ElementSetName:{value:this.resultType}}:{ElementSetName:{value:this.resultType},Constraint:{version:this.filterVersion,Filter:this.filter}},t.Query.SortBy={SortProperty:{PropertyName:{value:this.sortProperty},SortOrder:{value:this.sortOrder}}};var a=new OpenLayers.Format.CSWGetRecords;return a.write(t)},this.search=function(e,t,a){var i=[];if(!Utils.isNullOrUndefined(e.freeText)){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,property:"apiso:AnyText",value:e.freeText});i.push(n)}if(!Utils.isNullOrUndefined(e.title)){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:this.titleProperty,matchCase:!1,value:e.title});i.push(n)}if(Utils.isTrue(e.useBbox)){var r=null;if(r=e.bounds,null==r&&map)var r=map.getExtent();null!=r&&(r=r.transform(new OpenLayers.Projection(map.getProjection()),new OpenLayers.Projection("EPSG:4326")));var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Spatial.BBOX,property:"ows:BoundingBox",value:r});i.push(n)}if(!Utils.isNullOrUndefined(e.lastModifiedBegin)){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,property:this.lastModifiedBeginProperty,value:e.lastModifiedBegin+"T00:00:00Z"});i.push(n)}if(!Utils.isNullOrUndefined(e.lastModifiedEnd)){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,property:this.lastModifiedEndProperty,value:e.lastModifiedEnd+"T23:59:59Z"});i.push(n)}var l={url:GEONETWORK_URL+"/srv/eng/csw",filterVersion:this.filterVersion,resultType:"full"};0!=i.length?(l.filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:i}),l.emptySearch=!1):l.emptySearch=!0;var o=this.buildCSWRequestData(l);this.doSearchCSW(l.url,o,t,a)},this.doSearchCSW=function(e,t,a,i){var n="text/xml;charset=utf-8",r=new OpenLayers.Format.CSWGetRecords;OpenLayers.Request.POST({url:e,data:t,headers:{"Content-Type":n},success:function(e){var t=e.responseXML;t&&t.documentElement||(t=e.responseText);var i=r.read(t);a(i)},failure:function(){Utils.isNullOrUndefined(i)||i()}})}},DataDownloader=function(){this.downloadZip=function(e,t){var a=this.insertParam(e,"service","WFS");a=this.insertParam(a,"VERSION","1.0.0"),a=this.insertParam(a,"REQUEST","GetFeature"),a=this.insertParam(a,"typeName",t),a=this.insertParam(a,"outputFormat","SHAPE-ZIP"),window.location.assign(a)},this.insertParam=function(e,t,a){var i=RegExp("([?&])"+t+"=.*?(&|$)","i"),n=-1!==e.indexOf("?")?"&":"?";return e.match(i)?e.replace(i,"$1"+t+"="+a+"$2"):e+n+t+"="+a}};